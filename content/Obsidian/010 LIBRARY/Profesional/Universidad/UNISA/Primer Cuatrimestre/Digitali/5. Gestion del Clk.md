
# 5. Gestion del Clk
## Introducci√≥n

- **Introduzione**
	- Com'√® un clock ideale?
		- Quale sono i componenti dal clock?
	- Cos'√® un segnalo sincrono?
	- Cos'√® un segnalo mesocroni?
- **Clock Skew e Jitter**
	- Cos'√® il clock skew?
		- Quale tipi di clock skew ci sono?
		- Effetti del clock skew?
			- Sul setup?
			- Sul Hold
	- Cos'√® il clock Jitter?
		- Effetti del clock Jitter?
- **Gestione di Jitter e Skew**
	- Quale sono i diversi mettodi per gestionare il clock Jitter e il clock Skew?
- **Distribuzione del clock**
	- Quale sono le diverse distribuzione del clock?
		- Quando √® opportuno ciascuno?
	- Com'√® la distribuzione dal clock nella FPGA?
- **Generazione del Clock**
	- Come funziona il PLL?
		- Come funziona i singoli componenti dal PLL?
		- Come si usa il PLL per generazione?
		- Come si usa il PLL per sincronizacione?
	- Come funziona il DLL?
		- Come funziona i gingoli componente dal DLL?
		- Come si usa il DLL per generazione?
		- Come si usa il DLL per sincronizacione?
	- PLL vs DLL
- **Sincronizzacione dei Sistemi**
	- Quale sono i tipi di sistemi?
		- Com'√® un sistema GALS?
			- Vantaggi e svantaggi di questi sistema.
			- Cos'√® la metastabilit√†?
			- Come si puoi evitare la metastabilit√†?
	- Come funzionano i sistemi auto temporizzati?
		- Come funziona il handshake di 2 fasi?
		- Come funziona il handshake di 4 fasi?





# Italiano

## Introduzione

La gestione del clock √® fondamentale nei sistemi sincroni, poich√© assicura che tutti i componenti del sistema operino in armonia temporale. Un clock ideale dovrebbe permettere la sincronizzazione perfetta di tutte le operazioni, ma nella pratica si affrontano diverse deviazioni che possono influire sulle prestazioni del sistema. Queste deviazioni, come il clock skew e il jitter, devono essere gestite adeguatamente per mantenere l'efficienza e la funzionalit√† del sistema.

#### Clock Ideale 
- Un *clock ideale* √® un segnale periodico che attiva simultaneamente tutti i registri del sistema, garantendo che tutte le operazioni avvengano in sincronia perfetta. Questo segnale √® noto come segnale sincrono, e la sua periodicit√† garantisce che le transizioni dei registri avvengano allo stesso tempo, senza disallineamenti o ritardi.


#### Segnali Sincroni e Mesocroni
Un segnale sincrono ha una frequenza e una fase costanti, il che permette una sincronizzazione precisa di tutti i componenti del sistema. In contrasto, un segnale mesocrono mantiene la stessa frequenza del segnale sincrono, ma con una fase diversa. Questo significa che, sebbene i componenti del sistema operino alla stessa velocit√†, potrebbero non essere perfettamente allineati nel tempo, introducendo il concetto di skew.

### Osservazione Importante
Non importa il ritardo assoluto tra il generatore del clock e i registri. √à importante che i tempi di arrivo del clock siano il pi√π possibile uguali tra loro. Nella figura abbiamo la fonte del clock 1 e poi le diverse cause di skew e jitter che analizzeremo separatamente. Tutti questi oggetti variano le costanti di tempo con cui si muove il clock e poi introducono uno schema per variazioni deterministiche e fluttuazioni per variazioni casuali.
![[Pasted image 20240217205356.png|500]]

## Clock Skew e Jitter
![[Pasted image 20240217205159.png|500]]


### Skew 
Il clock skew √® il disallineamento temporale che si verifica quando il segnale di clock non arriva simultaneamente a tutti i componenti sincroni del sistema. Questo disallineamento pu√≤ essere dovuto a varie cause, tra cui:
- **Distribuzione del clock**: I ritardi nel sistema di distribuzione del clock possono causare che il segnale arrivi a diversi componenti in momenti diversi.
- **Carichi sbilanciati**: Differenze nei carichi elettrici lungo il percorso di distribuzione del clock possono introdurre variazioni nel tempo di arrivo.
- **Interconnessioni e buffer**: Ritardi non bilanciati nelle interconnessioni e nei buffer del clock.
- **Progettazione asimmetrica della distribuzione del clock**: Differenze nei percorsi e nei tempi di propagazione del clock attraverso il circuito.
![[Pasted image 20240217205621.png|400]]


#### Effetti dello Skew 
Possono esistere 2 tipi di situazioni: quando il dato e il clock hanno lo stesso senso (skew positivo) e quando hanno senso opposto (skew negativo).
- **Skew positivo:** Aumenta il periodo del clock. I dati incontrano un clock in cui il disallineamento aumenta.
![[Pasted image 20240217210340.png]]
- **Skew negativo:** C'√® un anticipo, il che significa un T equivalente minore.
![[Pasted image 20240217210352.png]]
**Circuito equivalente:**
![[Pasted image 20240217210402.png]]


#### Effetto sul Tempo di Setup del skew: 
- **Skew negativo**: Riduce il tempo effettivo disponibile per il setup, aumentando la difficolt√† di rispettare questo requisito temporale.
- **Skew positivo**: Aumenta il tempo effettivo disponibile per il setup, il che pu√≤ migliorare le prestazioni del sistema.
![[Pasted image 20240217210447.png]]
#### Effetto sul Tempo di Hold:
- **Skew positivo**: Rende pi√π stringenti i vincoli del tempo di hold, poich√© riduce il tempo effettivo di hold disponibile.
- **Skew negativo**: Allenta i vincoli del tempo di hold, poich√© aumenta il tempo effettivo di hold disponibile.
#### Conclusione
Lo skew pu√≤ influenzare significativamente la determinazione dei tempi di setup e hold in un sistema sincronizzato, influendo sulla stabilit√† e sulle prestazioni del circuito digitale. √à fondamentale gestire adeguatamente lo skew per garantire una corretta sincronizzazione e rispettare i requisiti di temporizzazione del sistema.
![[Pasted image 20240217210813.png]]


#### Skew Relativo vs Assoluto
La differenza tra lo skew assoluto e lo skew relativo si riferisce a come viene misurato il disallineamento temporale nell'arrivo del segnale di clock a diversi componenti del sistema.

**Skew Assoluto**: 

- **Definizione**: √à la differenza massima nel tempo di arrivo del segnale di clock tra il punto pi√π anticipato e il punto pi√π tardivo in tutto il sistema.
- **Misurazione**: Si misura come l'intervallo di tempo tra i momenti in cui il segnale di clock arriva ai diversi elementi sincroni pi√π distanti in termini temporali.
- **Impatto**: Lo skew assoluto influisce sulla sincronizzazione globale del sistema, poich√© rappresenta la massima discrepanza temporale nell'arrivo del clock a qualsiasi parte del circuito.

**Skew Relativo**:

- **Definizione**: √à la differenza nel tempo di arrivo del segnale di clock tra punti specifici all'interno di una parte pi√π piccola o locale del sistema, generalmente in regioni vicine tra loro.
- **Misurazione**: Si misura come l'intervallo di tempo tra i momenti in cui il segnale di clock arriva a due punti specifici all'interno di una regione determinata del circuito.
- **Impatto**: Lo skew relativo √® cruciale per la sincronizzazione locale e pu√≤ essere pi√π facile da gestire rispetto allo skew assoluto. Assicurare che lo skew relativo sia minimo aiuta a mantenere la coerenza temporale in subregioni del sistema, anche se lo skew assoluto pu√≤ essere maggiore.

**Esempio pratico**:

- **Skew assoluto**: In un circuito grande, se il clock arriva al registro A a 10 ns e al registro B a 15 ns, lo skew assoluto √® di 5 ns.
- **Skew relativo**: Se all'interno di una subregione del circuito, il clock arriva al registro C a 10 ns e al registro D a 11 ns, lo skew relativo in quella subregione √® di 1 ns, indipendentemente dal fatto che questi registri facciano parte dello stesso circuito dove lo skew assoluto √® maggiore.

### Jitter 
Il jitter √® una variazione nel tempo tra i cicli del clock che provoca inconsistenze nella frequenza del clock. A differenza dello skew, che √® una deviazione spaziale, il jitter √® una deviazione temporale. Si pu√≤ classificare in due tipi principali:
- **Jitter ciclo a ciclo**: Variazione nella durata tra due periodi consecutivi del clock. Questo tipo di jitter pu√≤ influire sulla sincronizzazione precisa dei componenti del sistema.
- **Jitter assoluto**: Massimo scostamento del periodo del clock rispetto al suo valore medio nominale. Questo valore √® critico per determinare il margine di errore massimo nella temporizzazione del sistema.
- **Jitter per frequenze vicine ma non uguali**

#### Cause del Jitter 
1. *Variazioni nella frequenza del clock*: Piccole fluttuazioni nella frequenza nominale del clock possono provocare jitter.
2. *Modulazione e rumore casuale*: Interferenze e fluttuazioni nel segnale di clock possono introdurre variazioni temporali tra i fronti consecutivi.
3. *Jitter ciclo a ciclo*: Differenze nella durata dei periodi del clock tra cicli successivi.
4. *Jitter assoluto*: La massima deviazione della durata del periodo del clock rispetto al valore medio.

### Effetti del Jitter 
Il jitter pu√≤ avere diversi effetti avversi sulle prestazioni del sistema:
- **Degradazione delle prestazioni**: Le variazioni nel tempo del clock possono provocare errori nella sincronizzazione dei dati, influenzando la precisione e l'efficienza del sistema.
- **Criticit√† del setup**: Simile allo skew, il jitter pu√≤ rendere pi√π difficile rispettare i requisiti di setup, poich√© introduce incertezza nella temporizzazione.
#### Percorso logico in sistemi attivati da fronti
![[Pasted image 20240217210932.png]]
#### Accorciamento dei percorsi
![[Pasted image 20240218102421.png]]


## Gestione di Jitter e Skew 
1. *Equalizzazione dei ritardi
2. *Uso di tecniche di clock gating
3. *Distribuzione accurata di dati e clock
4. *Generazione e distribuzione di clock di alta qualit√†*: Utilizzare circuiti di generazione di clock come DLL (Delay-Locked Loop) e PLL (Phase-Locked Loop)
5. *Analisi statistica del jitter*: Eseguire analisi statistiche, come il metodo di Montecarlo, per stimare e gestire il jitter in modo efficace nel progetto del sistema.
6. *Attenzione particolare agli FPGA*: Prestare particolare attenzione alla gestione del jitter e dello skew nei dispositivi FPGA, poich√© questi possono essere pi√π sensibili a queste non idealit√† a causa della loro architettura e configurazione.
7. *Disaccoppiamento dell'alimentazione*: Utilizzare tecniche di disaccoppiamento per stabilizzare l'alimentazione del circuito e ridurre le fluttuazioni che causano jitter.
- √à importante tenere presente che lo skew √® intrinseco e non pu√≤ essere eliminato, √® un effetto causale dovuto all'attraversamento di una parte fisica con la sua propria capacit√† resistenza...
	- Per questa ragione, pi√π che lo skew assoluto, mi interessa contenere uno skew relativo, cio√® la differenza tra il disallineamento di n piste.
### Metodi di Analisi
Per valutare e gestire lo skew e il jitter, si utilizzano diversi metodi di analisi:
- **Place and route**: Questo processo aiuta a stimare e bilanciare i ritardi nei percorsi del clock, mitigando gli effetti dello skew.
- **Simulazioni Montecarlo**: Queste simulazioni permettono di prevedere le variazioni del jitter e di adattare il progetto del sistema per minimizzarne l'impatto.
- **Analisi termica e di alimentazione**: Valutare le variazioni termiche e di alimentazione per progettare strategie di mitigazione adeguate.
499

## Distribuzione del Clock 
La distribuzione del clock √® cruciale per assicurare che tutti i componenti del sistema ricevano segnali di clock sincronizzati e per minimizzare sia lo skew che il jitter. Un progetto efficiente della distribuzione del clock pu√≤ migliorare significativamente le prestazioni del sistema.
Ha l'obiettivo di minimizzare la componente deterministica del clock skew. Queste distribuzioni vengono effettuate dopo le interconnessioni con la porta di destinazione.
### Distribuzione del Clock ad Albero
   - Approccio per eguagliare i ritardi relativi: Distribuendo il clock in un progetto a forma di albero, si cerca di bilanciare i ritardi relativi tra i diversi rami dell'albero per minimizzare lo skew e garantire una sincronizzazione adeguata.
   - Regolazione delle dimensioni dei buffer e delle interconnessioni: Se i percorsi di distribuzione del clock non sono identici, si pu√≤ regolare la dimensione dei buffer e delle interconnessioni per bilanciare i ritardi e ridurre lo skew.
   - Fondamentalmente, tutti lo stesso ritardo.
   - Occupa poca area.
#### Albero H
Si utilizza una struttura ad H per bilanciare i ritardi.
![[Pasted image 20240218103912.png]]
![[Pasted image 20240218104507.png]]
### Distribuzione del Clock a Griglia
   - Minimizzazione dello skew assoluto: La distribuzione del clock a griglia ha come obiettivo minimizzare lo skew assoluto inviando il segnale di clock da pi√π direzioni. Questo aiuta a ridurre le variazioni nei tempi di arrivo del clock ai diversi punti del circuito.
   - Indipendenza dalla posizione dei registri: Implementando una distribuzione a griglia, si cerca di minimizzare l'impatto della posizione dei registri sui ritardi del clock, il che pu√≤ migliorare la stabilit√† della sincronizzazione.
![[Pasted image 20240218104535.png]]
### Distribuzione del Clock negli FPGA
   - Attenzione particolare alla gestione del jitter e dello skew: A causa dell'architettura e della configurazione dei dispositivi FPGA, √® importante prestare particolare attenzione alla distribuzione del clock per mitigare gli effetti del jitter e dello skew in questi dispositivi.
   - Uso dei PLL per regolare lo skew: Nei dispositivi FPGA, si possono utilizzare i PLL (Phase-Locked Loop) per regolare lo skew e migliorare la sincronizzazione del clock nel circuito.


## Generazione del Clock
Il clock √® il cuore di qualsiasi sistema digitale, fornendo il segnale di sincronizzazione che coordina le operazioni di tutti i componenti del sistema. Senza un clock preciso, i componenti non potrebbero operare in modo armonioso, il che risulterebbe in errori nel processamento dei dati.
- **Frequenza**: La frequenza del clock determina la velocit√† con cui operano i circuiti digitali. Una maggiore frequenza permette di eseguire pi√π operazioni in meno tempo, ma aumenta anche il consumo di energia e la generazione di calore.
- **Fase**: La fase del clock √® cruciale per la sincronizzazione. Qualsiasi disallineamento nella fase pu√≤ causare problemi di temporizzazione, noti come skew.

### Concetti Preliminari Importanti
#### Oscillatori al Quarzo

Un oscillatore al quarzo utilizza le propriet√† piezoelettriche del quarzo per generare un segnale di clock stabile e preciso. Quando si applica una tensione elettrica al cristallo di quarzo, questo vibra a una frequenza specifica che dipende dal suo taglio e dalle sue dimensioni. Queste vibrazioni vengono convertite in un segnale elettrico periodico che viene utilizzato come clock.
- **Vantaggi**:
    - Alta stabilit√† e precisione.
    - Bassa deriva di frequenza nel tempo.
    - Buona immunit√† al rumore e alle variazioni di temperatura.
- **Limitazioni**:
    - Limitazione nella frequenza massima (centinaia di MHz).
    - Non possono essere regolati dinamicamente per cambiare la frequenza.
    - Generare clock ad alta frequenza (oltre centinaia di MHz) fuori dal chip pu√≤ risultare in perdita di segnale a causa delle limitazioni fisiche e della dissipazione di energia nelle piste del PCB.

#### Moltiplicatori e Divisori di Frequenza

I moltiplicatori e i divisori di frequenza sono circuiti che regolano la frequenza del clock generato dall'oscillatore al quarzo per adattarsi alle esigenze del sistema digitale.

- **Moltiplicatori di Frequenza**: Aumentano la frequenza del clock. Utilizzati quando si necessita di una frequenza di operazione pi√π alta rispetto a quella fornita dall'oscillatore al quarzo.
    - **PLL (Phase-Locked Loop)**: Utilizzato per moltiplicare la frequenza del clock di riferimento.
- **Divisori di Frequenza**: Riduciono la frequenza del clock. Utilizzati quando si necessita di una frequenza pi√π bassa per certe parti del circuito.
    - **Divisori a Flip-Flop**: Implementati utilizzando flip-flop di tipo T in cascata.


### PLL 
![[Pasted image 20240218110031.png]]
Un PLL √® un circuito che sincronizza la frequenza e la fase di un oscillatore controllato (VCO) con un segnale di riferimento. √à ampiamente utilizzato nei sistemi digitali per generare clock ad alta frequenza a partire da un segnale di riferimento a bassa frequenza.
- **Phase Detector (PD)**: Rileva la differenza di fase tra il segnale di riferimento e il segnale di feedback del VCO.
- **Charge Pump (CP)**: Converte la differenza di fase rilevata in una corrente che regola la tensione del VCO.
- **Loop Filter (LF)**: Filtra il segnale della charge pump per smorzare la tensione di controllo del VCO e ridurre il jitter.
- **Voltage-Controlled Oscillator (VCO)**: Genera un segnale di frequenza controllata dalla tensione di ingresso.
- **Divisore di Frequenza**: Divide la frequenza del segnale del VCO per generare il segnale di feedback al phase detector. Se non presente, viene utilizzato per creare due clock con uno skew pari a zero, ma inoltre c'√® questo blocco per moltiplicare.


![[Pasted image 20240218110045.png]]
- Se si lavora con piccoli segnali, pu√≤ essere linearizzato in un intervallo della frequenza di free running e possiamo descrivere i blocchi con una funzione di trasferimento e il PLL si comporta in questo caso come un LP di secondo ordine ü°™ per piccole deviazioni dalla condizione di aggancio.
- Il PLL lavora essenzialmente sulle fasi dei segnali che entrano.
![[Pasted image 20240218110408.png]]
#### Phase Detector (PD)
Confronta la fase di due segnali di ingresso e genera un'uscita proporzionale al disallineamento tra di essi. Con questo tipo di circuito non riesco a sapere se il disallineamento √® positivo o negativo. Questo pu√≤ funzionare in certe circostanze, ma con prestazioni limitate, poich√© in realt√† si sta osservando un ritardo e pu√≤ sempre essere interpretato come un anticipo. Tuttavia, lavorando con piccoli segnali, questi disallineamenti sono generalmente piccoli rispetto al valore nominale. Quando si lavora con disallineamenti grandi, si perde la linearit√†.
![[Pasted image 20240218111113.png]]
#### Phase-Frequency Detector (PFD):
![[Pasted image 20240218111158.png]]
Il Phase-Frequency Detector √® un'estensione del PD che non solo rileva la differenza di fase tra i segnali di ingresso, ma pu√≤ anche rilevare differenze nella frequenza. Questo permette al PFD di controllare sia la fase che la frequenza del VCO in modo pi√π preciso, migliorando la stabilit√† e la velocit√† del processo di sincronizzazione.
Il Phase-Frequency Detector (PFD) viene implementato come una macchina a stati: 2 registri e una porta logica. L'uscita dei due Flip-Flop viene letta dalla porta logica in retroazione, e l'uscita della porta logica controlla il reset dei due registri. In questo modo, si pu√≤ determinare il segno del disallineamento, poich√© ci sono due segnali, 'up' e 'down', che controllano la carica della pompa di carica.
#### Charge Pump (Pompa di Carica):
Rileva l'errore di fase di corrente tra due segnali. 
Poich√© la corrente della pompa di carica √® costante, avremo che la fdt √® una costante K del rilevatore di fase.
![[Pasted image 20240218111839.png]]
#### Loop Filter (Filtro di Anello):
![[Pasted image 20240218111933.png]]
Il loop filter √® un componente cruciale in un PLL che si occupa di garantire la stabilit√† del sistema. Si tratta di un filtro passa-basso che genera una rampa di controllo per il VCO. Il loop filter √® fondamentale per ridurre il jitter del "system clock" e mantenere la stabilit√† del sistema di controllo di fase.
#### Ring-Oscillator VCO (VCO ad Anello di Oscillatore):
Il VCO basato su anello di oscillatore √® un tipo di oscillatore utilizzato nella generazione di segnali di clock nei circuiti integrati. Consiste in una serie di inverter in un anello di retroazione che generano un'oscillazione. Questo tipo di VCO √® comune nelle librerie standard delle tecnologie di fabbricazione e viene utilizzato per confrontare le prestazioni di diverse tecnologie.
![[Pasted image 20240218111949.png]]
#### Frequency Divider (Divisore di Frequenza):
Il frequency divider √® un componente utilizzato per dividere la frequenza di un segnale di clock. In un PLL, il frequency divider viene impiegato nella retroazione per moltiplicare o dividere la frequenza del clock di uscita rispetto al segnale di riferimento. Questo permette di regolare la frequenza del segnale di uscita in base ai requisiti del sistema.


### PLL come Base di Distribuzione del Clock  
La distribuzione del clock utilizzando PLL (Phase-Locked Loop) permette che molteplici sistemi digitali ricevano segnali di clock perfettamente sincronizzati in fase. Questo si ottiene utilizzando PLL come buffer a ritardo zero (zero delay buffers).
![[Pasted image 20240218112133.png]]
#### Funzionamento
1. **Phase Detector (PD)**: Confronta la fase del segnale di riferimento con il segnale di feedback e genera segnali di errore ("up" e "down").
2. **Charge Pump (CP)**: Converte i segnali di errore in una corrente che regola la tensione di ingresso del filtro di loop.
3. **Loop Filter (LF)**: Filtra il segnale della charge pump per stabilizzare la tensione di controllo del VCO.
4. **Voltage-Controlled Oscillator (VCO)**: Genera un segnale di clock la cui frequenza viene regolata in base alla tensione di controllo.
5. **Clock Driver**: Amplifica il segnale di clock per distribuirlo al sistema digitale.


### PLL come Base della Sincronizzazione 
La sincronizzazione basata su PLL viene utilizzata per assicurare che il segnale di clock in un chip sia perfettamente sincronizzato con il segnale di clock in un altro chip, anche quando i dati vengono trasferiti a una frequenza inferiore rispetto al clock di sistema. Questo √® cruciale nei sistemi in cui i dati devono essere trasferiti in modo sincrono tra chip differenti.
![[Pasted image 20240218112213.png]]
#### Funzionamento
1. **PLL nel Chip 1**: Genera un clock di sistema a partire da un oscillatore al quarzo e un divisore di frequenza.
2. **Divisore di Frequenza**: Genera un clock di riferimento a partire dal clock di sistema per trasferire i dati.
3. **Trasferimento di Dati**: I dati vengono trasferiti dal Chip 1 al Chip 2 in modo sincrono con il clock di riferimento.
4. **PLL nel Chip 2**: Riceve il clock di riferimento e lo utilizza per sincronizzare il proprio clock interno, annullando gli effetti del ritardo del buffer di clock (de-skewing).



### DLL 
La generazione del clock utilizzando DLLs (Delay-Locked Loops) √® un approccio alternativo all'uso dei PLLs (Phase-Locked Loops) per la generazione e la sincronizzazione dei segnali di clock nei circuiti integrati.
Un DLL √® un circuito simile a un PLL, ma invece di regolare la frequenza di un VCO, regola il ritardo di una linea di ritardo controllata da tensione per sincronizzare la fase del segnale di uscita con il segnale di ingresso.
Un Delay-Locked Loop √® un tipo di circuito di controllo di loop che si basa su una linea di ritardo controllata da tensione anzich√© un oscillatore controllato da tensione. In un DLL, si cerca di allineare perfettamente i segnali di riferimento e di uscita (deskewing) regolando il ritardo della linea di ritardo.
#### Differenze tra PLL e DLL
- **PLL**: Regola la frequenza per sincronizzare la fase e pu√≤ moltiplicare la frequenza del segnale di riferimento.
- **DLL**: Regola direttamente la fase tramite una linea di ritardo e non pu√≤ moltiplicare la frequenza del segnale di riferimento.
#### Componenti e Funzionamento del DLL
- **Phase Detector (PD)**: Rileva la differenza di fase tra il segnale di ingresso e il segnale di uscita.
- **Charge Pump (CP)**: Genera una corrente basata sulla differenza di fase.
- **Delay Line**: Una linea di ritardo controllata da tensione che regola il ritardo del segnale di uscita per sincronizzarlo con il segnale di ingresso.
#### Applicazioni del DLL nei Sistemi Digitali
- **Refaseo del Clock**: Regolazione fine della fase del clock per minimizzare lo skew.
- **Sincronizzazione dei Dati**: Sincronizzazione dei segnali di dati in interfacce ad alta velocit√†.
![[Pasted image 20240218112529.png]]
- Non ha un oscillatore controllato da tensione.
- In condizioni di sincronizzazione, i segnali di ingresso e uscita sono perfettamente allineati in termini di fase (deskewing).
- I DLL non permettono la moltiplicazione della frequenza del segnale di riferimento, a differenza dei PLL.
- I DLL sono sistemi incondizionatamente stabili e tendono ad avere un minor jitter rispetto ai PLL.


### DLL come Base di Distribuzione del Clock 
![[Pasted image 20240218113511.png]]



## Sincronizzazione dei Sistemi

### Introduzione
#### Sistemi Sincroni
I sistemi sincroni operano con un clock globale che coordina il funzionamento di tutti i componenti. Ogni elemento del sistema esegue le proprie operazioni in sincronia con questo clock, il che permette una coordinazione precisa e prevedibile delle attivit√†. Questi sistemi sono comuni nella maggior parte dei circuiti integrati grazie alla loro semplicit√† e prevedibilit√†.
- **Definizione e Caratteristiche**: Un sistema sincrono utilizza un clock globale per sincronizzare tutte le sue operazioni. Questo assicura che tutte le parti del sistema lavorino insieme in modo coordinato.
- **Esempi di Applicazioni Comuni**: Microprocessori, memorie e altri circuiti integrati digitali.
#### Sistemi Asincroni
A differenza dei sistemi sincroni, i sistemi asincroni non dipendono da un clock globale. Al contrario, le operazioni si avviano e si completano in funzione di eventi o segnali specifici. Questo pu√≤ offrire vantaggi in termini di flessibilit√† ed efficienza energetica, ma presenta anche sfide significative in termini di progettazione e sincronizzazione.
- **Definizione e Caratteristiche**: Un sistema asincrono opera senza un clock globale, basandosi su eventi esterni per avviare e completare operazioni.
- **Esempi di Eventi Asincroni**: Ingresso da una tastiera, segnali di sensori, ecc.


### Tipi di sistema
- **Veramente Asincrono**
- **Sistemi globalmente Asincroni-Localmente Sincroni**
	- **Definizione e Descrizione del Funzionamento**: I sistemi GALS consistono in vari sotto-sistemi sincroni che operano a diverse frequenze di clock, ma comunicano tra loro in modo asincrono. Ogni sotto-sistema ha il proprio clock locale.
	- **Vantaggi e Svantaggi**: 
		- *Vantaggi*: Maggiore flessibilit√†, efficienza energetica, riduzione dei problemi di skew.
		- *Svantaggi*: Complessit√† nella progettazione, necessit√† di meccanismi di sincronizzazione aggiuntivi.
	- **Esempi e Applicazioni**: Sistemi integrati in dispositivi mobili, dove diversi moduli (come CPU, GPU e moduli di comunicazione) operano a frequenze diverse.
- **Sistema autotemporizzato**
	- **Definizione e Funzionamento**: Un sistema auto-temporizzato completa le sue operazioni basandosi su segnali di handshaking e completamento, anzich√© dipendere da un clock globale.
	- **Vantaggi e Svantaggi**: 
		 - *Vantaggi*: Risparmio di potenza, riduzione dell'area del chip, maggiore tolleranza a variazioni nel processo e nella temperatura.
		- *Svantaggi*: Necessit√† di circuiteria aggiuntiva, complessit√† nella progettazione.
	- **Esempi e Applicazioni**: Circuiti specifici che richiedono alta efficienza energetica e tolleranza a variazioni, come certi moduli in sistemi integrati avanzati.

### Sistemi Globalmente Asincroni-Localmente Sincroni (GALS)
![[Pasted image 20240720102313.png]]
I sistemi GALS combinano il meglio di entrambi i mondi, utilizzando clock locali per sincronizzare operazioni all'interno di piccoli sotto-sistemi, mentre permettono a questi sotto-sistemi di operare asincronamente tra loro. Questo approccio pu√≤ migliorare la flessibilit√† e l'efficienza energetica, riducendo al contempo i problemi di temporizzazione e skew.

#### Problema: Metastabilit√†
Il problema di queste sistema √® la sua elevata probabilita di metastabilit√†.
La metastabilit√† √® uno stato in cui un flip-flop pu√≤ rimanere intrappolato in una condizione intermedia tra uno stato logico alto e uno basso. Questo stato indefinito pu√≤ verificarsi quando il flip-flop riceve un segnale di ingresso asincrono o quando i tempi di configurazione e mantenimento non vengono rispettati adeguatamente. L'uscita dalla metastabilit√† √® imprevedibile, sia in termini di tempo che di valore logico, il che pu√≤ causare errori nel sistema.
![[Pasted image 20240206183721.png]]
##### Modelli di Metastabilit√†
- La possibilit√† di metastabilit√† quando abbiamo un segnale asincrono √® 2 volte il tempo di salita diviso nel periodo
$$P_{\epsilon}=\frac{2t_e}{T}$$
Se il clock varia con la nostra frequenza: $N=P_{\epsilon}.f_{clk}$
Dove N √® MTBF, che √® una caratteristica della qualit√† del nostro sistema
$$MTBF=\frac{e^{\frac{t_{m,max}}{\tau}}}{f_{ck}.f_{signal}t_0}$$
![[Pasted image 20240720102715.png]]
Per comprendere e mitigare la metastabilit√†, si utilizzano vari modelli matematici e fisici. Un modello comune √® il modello di un singolo polo per un flip-flop, che descrive come un flip-flop pu√≤ entrare e uscire da uno stato metastabile.
$$v_q(t)=V_M+(v_a(0)-V_M).e^{\frac{t}{\tau}}$$
- **VM**: Tensione di metastabilit√†.
- **v(0)**: Valore iniziale della tensione.
- **œÑ**: Costante di tempo che varia con le condizioni del processo e ambientali (come la temperatura).
Esiste una fascia di valori proibiti intorno a $VM$, con un'ampiezza di $2v_Œµ$, dove il tempo per uscire dalla metastabilit√† (tm) supera un valore massimo (tm,max), risultando in un errore di sincronizzazione.
Imponendo $VM = VDD/2$ e $Vq(tm) = VDD$, il modello prevede un tempo infinito per l'uscita dalla metastabilit√† se l'ingresso vale esattamente VM.
![[Pasted image 20240720103256.png]]
#### Mitigazione della Metastabilit√†
Anche se non si pu√≤ eliminare completamente il rischio di metastabilit√†, si possono prendere misure per ridurne la probabilit√† e mitigarne gli effetti:
- **Uso di Flip-Flops in Cascata**: Posizionare due flip-flops in cascata pu√≤ ridurre la probabilit√† che la metastabilit√† influenzi l'operazione del sistema, a scapito di un aumento della latenza.
- **Aumento del Timing**: Regolare i tempi di configurazione e mantenimento per adattarsi al peggiore caso di tempo di uscita dalla metastabilit√† pu√≤ aiutare a minimizzarne l'impatto.


### Sistemi Auto-temporizzati (Self-timed)

![[Captura de pantalla 2024-09-20 a las 9.18.28 a. m..png]]

I sistemi auto-temporizzati, o self-timed, operano senza un clock globale, utilizzando invece segnali di handshaking e di completamento per coordinare le operazioni. Questo permette che ogni componente del sistema funzioni al proprio ritmo, basato sulla disponibilit√† dei dati e sul completamento delle operazioni precedenti, il che pu√≤ risultare in una maggiore efficienza energetica e un uso pi√π efficace dell'area del chip.
- **Separazione tra Ordinamento Logico e Fisico**: I sistemi auto-temporizzati permettono una chiara distinzione tra la logica del circuito e l'ordinamento fisico dei suoi componenti.
- **Considerazione del Ritardo come Media**: Invece di progettare in funzione del peggiore caso di ritardo, questi sistemi considerano la media dei ritardi, il che pu√≤ portare a un design pi√π efficiente.
- **Risparmio di Potenza e Area**: Eliminando la necessit√† di un clock globale, si riduce il consumo di energia e l'area dedicata alla distribuzione del clock nel chip.
- **Circuiteria Aggiuntiva per Sincronismo**: Si richiede circuiteria aggiuntiva per gestire i segnali di sincronismo e handshaking.
#### Modulo di Ritardo
![[Captura de pantalla 2024-09-20 a las 9.18.12 a. m..png]]
Nei sistemi auto-temporizzati, i moduli di ritardo sono cruciali per assicurare che i segnali si propaghino correttamente e senza disallineamenti.
- **Portelogiche Fittizie**: Queste porte logiche artificiali hanno lo stesso ritardo critico della rete logica e si posizionano vicino alla rete per evitare disallineamenti dovuti a variazioni di temperatura o processo.
#### Esempio: Self-Timed Adder
![[Captura de pantalla 2024-09-20 a las 9.20.50 a. m..png]]
Un esempio di sistema auto-temporizzato √® un sommatore auto-temporizzato, che opera in modo efficiente coordinando le operazioni tramite segnali di handshaking.
- **Generazione Differenziale del Carry**: Questo approccio riduce il tempo critico del carry modificando la catena di carry di Manchester.
- **Sensing di Corrente per Segnale di Completamento**: Utilizza la rilevazione di corrente per generare segnali di completamento, assicurando che le operazioni si completino prima di passare alla fase successiva.
- **Mindelay Generator**: Questo componente evita blocchi nel caso in cui la logica non commuti adeguatamente.




#### Protocolli Hand-Shaking 
##### Handshake a Due Fasi
![[Captura de pantalla 2024-09-20 a las 9.36.15 a. m..png]]
Il protocollo di handshake a due fasi √® una tecnica di sincronizzazione utilizzata per coordinare la comunicazione tra un emittente e un ricevitore mediante segnali di richiesta (Req) e riconoscimento (Ack).
- **Configurazione Sender-Receiver**: L'emittente e il ricevitore scambiano segnali di Req e Ack per avviare e completare il trasferimento dei dati.
- **Descrizione del Diagramma Temporale**:
  - *Ciclo 1*: L'emittente invia un segnale di richiesta (Req).
  - *Ciclo 2*: Il ricevitore risponde con un segnale di riconoscimento (Ack), indicando che ha ricevuto e processato la richiesta.
##### Handshake a Quattro Fasi
Il protocollo di handshake a quattro fasi utilizza un ciclo di quattro passaggi per sincronizzare le operazioni, fornendo una gestione robusta e flessibile dei segnali di completamento.
- **Vantaggi**: Questo protocollo √® pi√π robusto e tollerante agli errori, fornendo una sincronizzazione pi√π affidabile nei sistemi complessi.
- **Svantaggi**: Pu√≤ essere pi√π lento e consumare pi√π risorse rispetto al protocollo a due fasi.
##### Esempio di FIFO Auto-temporizzato
![[Captura de pantalla 2024-09-20 a las 9.38.09 a. m..png]]
Un FIFO auto-temporizzato utilizza protocolli di handshake per gestire il trasferimento dei dati tra le fasi, assicurando che ogni fase sia completa prima di passare alla successiva.
- **Indicatori di Pipeline Vuoto e Pieno**:
  - *Pipeline Vuoto*: Tutti i bit sono 1 o 0.
  - *Pipeline Pieno*: I bit alternano tra 1 e 0.
Questi indicatori permettono una gestione efficiente del flusso di dati, assicurando che il sistema operi in modo ottimale e senza interruzioni.





### Observazione
#### Sincronizzazione di Segnali Asincroni 
##### Flip-Flops come Sincronizzatori
I flip-flops sono i blocchi di costruzione fondamentali per sincronizzare segnali asincroni. Vengono utilizzati per catturare e stabilizzare segnali che arrivano in momenti non sincronizzati con il clock del sistema.
- **Uso di Base**: Un flip-flop semplice pu√≤ sincronizzare un segnale asincrono campionandolo sul bordo del clock del sistema.
- **Problemi Potenziali**: La violazione dei constraints temporali pu√≤ portare alla metastabilit√†, dove il flip-flop non pu√≤ risolvere la sua uscita in un tempo finito.
##### Sincronizzazione nei Sistemi GALS
Nei sistemi GALS, √® essenziale utilizzare bistabili per la sincronizzazione di segnali tra sotto-sistemi che operano a diverse frequenze di clock. Questo approccio permette che ogni sotto-sistema mantenga la propria sincronizzazione locale mentre comunica in modo sicuro con altri sotto-sistemi.
- **Bistabili per Sincronizzazione**: I bistabili vengono usati per catturare e sincronizzare i segnali di ingresso provenienti da altri sotto-sistemi asincroni.
- **Considerazioni di Timing**: Si deve tener conto di un aumento nel ritardo tCQ, che √® il tempo necessario per catturare e propagare un segnale attraverso il bistabile.
# Espa√±ol
## Introducci√≥n

La gesti√≥n del clock es fundamental en los sistemas sincronos, ya que asegura que todos los componentes del sistema operen en armon√≠a temporal. Un clock ideal deber√≠a permitir la sincronizaci√≥n perfecta de todas las operaciones, pero en la pr√°ctica, se enfrenta a diversas desviaciones que pueden afectar el rendimiento del sistema. Estas desviaciones, como el clock skew y el jitter, deben ser gestionadas adecuadamente para mantener la eficiencia y la funcionalidad del sistema
#### Clock Ideal
- Un *clock ideal* es un segnale periodico que activa simult√°neamente todos los registros del sistema, asegurando que todas las operaciones se realicen en sincron√≠a perfecta. Este se√±al se conoce como se√±al sincrona, y su periodicidad garantiza que las transiciones de los registros se realicen al mismo tiempo, sin desalineaciones ni retrasos.

#### Se√±ales sincronas y mesocrono
Una se√±al sincrona tiene una frecuencia y fase constantes, lo que permite una sincronizaci√≥n precisa de todos los componentes del sistema. En contraste, una se√±al mesocrono mantiene la misma frecuencia que la se√±al sincrona, pero con una fase diferente. Esto significa que aunque los componentes del sistema operen a la misma velocidad, pueden no estar perfectamente alineados en el tiempo, lo que introduce el concepto de skew.

### Observacion importante
No importa el retraso absoluto entre el generador del reloj y los registros. Es importante que los tiempos de llegada del reloj sean lo m√°s iguales posible entre s√≠. En la figura tenemos la fuente del reloj 1 y luego las diferentes causas de skew y jitter que ahora analizaremos por separado. Todos estos objetos var√≠an las constantes de tiempo con las que se mueve el reloj y luego introducen un bosquejo para variaciones deterministas y fluctuaciones para variaciones aleatorias.
![[Pasted image 20240217205356.png|500]]

## Clock Skew y Jitter
![[Pasted image 20240217205159.png|500]]
### Skew
El clock skew es el desalineamiento temporal que ocurre cuando el se√±al de clock no llega simult√°neamente a todos los componentes sincronos del sistema. Este desalineamiento puede deberse a varias causas, incluyendo:
- **Distribuci√≥n del clock**: Los retardos en el sistema de distribuci√≥n del clock pueden causar que la se√±al llegue a diferentes componentes en diferentes momentos.
- **Cargas desbalanceadas**: Diferencias en las cargas el√©ctricas a lo largo del camino de distribuci√≥n del clock pueden introducir variaciones en el tiempo de llegada.
- **Interconexiones y buffers**: Retardos no balanceados en las interconexiones y buffers del clock.
- **Dise√±o asim√©trico de la distribuci√≥n del clock**: diferencias en las rutas y tiempos de propagaci√≥n del clock a trav√©s del circuito.
![[Pasted image 20240217205621.png|400]]

#### Efectos del Skew
Pueden existir 2 tipos de situaciones, cuando el dato y el clok tienen el mismo sentido(skew positivo) y cuando tienen opuesto(negativo)
- **Skew positivo:** Aumenta el perdiodo del clock. Los datos encuentran un clock en el cual el desafe aumenta.
![[Pasted image 20240217210340.png]]
- **Skew negativo:** Hay un anticipo, lo que significa un T equivalente menor.
![[Pasted image 20240217210352.png]]
**Circuito equivalente:**
![[Pasted image 20240217210402.png]]
#### Efecto en el tiempo de setup:
- **Skew negativo**: Reduce el tiempo efectivo disponible para el setup, aumentando la dificultad de cumplir con este requisito temporal.
- **Skew positivo**: Aumenta el tiempo efectivo disponible para el setup, lo que puede mejorar las prestaciones del sistema.
![[Pasted image 20240217210447.png]]
##### Efecto en el tiempo de hold:
- **Skew positivo**: Hace m√°s estrictas las restricciones del tiempo de hold, ya que reduce el tiempo efectivo de hold disponible.
- **Skew negativo**: Relaja las restricciones del tiempo de hold, ya que aumenta el tiempo efectivo de hold disponible.

#### Conclusion
El skew puede influir significativamente en la determinaci√≥n de los tiempos de setup y hold en un sistema sincronizado, afectando la estabilidad y el rendimiento del circuito digital. Es fundamental gestionar adecuadamente el skew para garantizar una sincronizaci√≥n correcta y cumplir con los requisitos de temporizaci√≥n del sistema.
![[Pasted image 20240217210813.png]]


#### Skew relativo vs absoluto
La diferencia entre el skew absoluto y el skew relativo se refiere a c√≥mo se mide la desalineaci√≥n temporal en la llegada del se√±al de clock a diferentes componentes del sistema.

**Skew absoluto**: 

- **Definici√≥n**: Es la diferencia m√°xima en el tiempo de llegada del se√±al de clock entre el punto m√°s temprano y el punto m√°s tard√≠o en todo el sistema.
- **Medici√≥n**: Se mide como el intervalo de tiempo entre los momentos en que el se√±al de clock llega a los diferentes elementos sincronos m√°s alejados en t√©rminos temporales.
- **Impacto**: El skew absoluto afecta la sincronizaci√≥n global del sistema, ya que representa la m√°xima discrepancia temporal en la llegada del clock a cualquier parte del circuito.

**Skew relativo**:

- **Definici√≥n**: Es la diferencia en el tiempo de llegada del se√±al de clock entre puntos espec√≠ficos dentro de una parte m√°s peque√±a o local del sistema, generalmente en regiones cercanas entre s√≠.
- **Medici√≥n**: Se mide como el intervalo de tiempo entre los momentos en que el se√±al de clock llega a dos puntos espec√≠ficos dentro de una regi√≥n determinada del circuito.
- **Impacto**: El skew relativo es crucial para la sincronizaci√≥n local y puede ser m√°s f√°cil de gestionar que el skew absoluto. Asegurar que el skew relativo sea m√≠nimo ayuda a mantener la coherencia temporal en subregiones del sistema, aunque el skew absoluto pueda ser mayor.

**Ejemplo pr√°ctico**:

- **Skew absoluto**: En un circuito grande, si el clock llega al registro A a las 10 ns y al registro B a las 15 ns, el skew absoluto es de 5 ns.
- **Skew relativo**: Si dentro de una subregi√≥n del circuito, el clock llega al registro C a las 10 ns y al registro D a las 11 ns, el skew relativo en esa subregi√≥n es de 1 ns, independientemente de que estos registros formen parte del mismo circuito donde el skew absoluto es mayor.



### Jitter

El jitter es una variaci√≥n en el tiempo entre los ciclos del reloj que provoca inconsistencias en la frecuencia del clock. A diferencia del skew, que es una desviaci√≥n espacial, el jitter es una desviaci√≥n temporal. Se puede clasificar en dos tipos principales:

- **Jitter ciclo a ciclo**: Variaci√≥n en la duraci√≥n entre dos periodos consecutivos del clock. Este tipo de jitter puede afectar la sincronizaci√≥n precisa de los componentes del sistema.
- **Jitter absoluto**: M√°ximo desv√≠o del periodo del clock respecto a su valor medio nominal. Este valor es cr√≠tico para determinar el margen de error m√°ximo en la temporizaci√≥n del sistema.
- **Jitter por frecuencias cercanas pero no iguales**
 
#### Causas de Jitter
1. *Variaciones en la frecuencia del clock*: peque√±as fluctuaciones en la frecuencia nominal del clock pueden provocar jitter.
2. *Modulaci√≥n y ruido aleatorio*: interferencias y fluctuaciones en la se√±al de clock pueden introducir variaciones temporales entre los flancos consecutivos.
3. *Jitter ciclo a ciclo*: diferencias en la duraci√≥n de los periodos del clock entre ciclos sucesivos.
4. *Jitter absoluto*: la m√°xima desviaci√≥n de la duraci√≥n del periodo del clock respecto al valor medio.



### Efectos del jitter
El jitter puede tener varios efectos adversos en el rendimiento del sistema:
- **Degradaci√≥n de las prestaciones**: Las variaciones en el tiempo del clock pueden provocar errores en la sincronizaci√≥n de datos, afectando la precisi√≥n y la eficiencia del sistema.
- **Criticidad del setup**: Similar al skew, el jitter puede hacer m√°s dif√≠cil cumplir con los requisitos de setup, ya que introduce incertidumbre en la temporizaci√≥n.
#### Ruta logica en sistemas disparados por flancos

![[Pasted image 20240217210932.png]]
#### Acortamiento de caminos
![[Pasted image 20240218102421.png]]




## Gestion de jitter e skew
1. *Equalizaci√≥n de los retardos
2. *Uso de t√©cnicas de clock gating
3. *Distribuci√≥n cuidadosa de datos y clock
4. *Generaci√≥n y distribuci√≥n de clock de alta calidad:* Utilizar circuitos de generaci√≥n de clock como DLL (Delay-Locked Loop) y PLL (Phase-Locked Loop)
5. *An√°lisis estad√≠stico del jitter:* Realizar an√°lisis estad√≠sticos, como el m√©todo de Montecarlo, para estimar y gestionar el jitter de manera efectiva en el dise√±o del sistema.
6. *Enfoque en FPGA:* Prestar especial atenci√≥n a la gesti√≥n del jitter y del skew en dispositivos FPGA, ya que estos pueden ser m√°s sensibles a estas no idealidades debido a su arquitectura y configuraci√≥n.
7. *Disaccoplamiento de alimentaci√≥n*: Utilizar t√©cnicas de desacoplamiento para estabilizar la alimentaci√≥n del circuito y reducir las fluctuaciones que causan jitter.


- Hay que tener en cuenta algo muy importante: el skew es intr√≠nseco y no puede ser eliminado, es un efecto causal causado por el cruce de una parte f√≠sica con su propia capacidad resistencia... 
	- Por esa raz√≥n, m√°s que el skew absoluto, estoy interesado en contener un skew relativo, es decir, la diferencia entre el desfase de n pistas.
### M√©todos de an√°lisis

Para evaluar y gestionar el skew y el jitter, se utilizan varios m√©todos de an√°lisis:

- **Place and route**: Este proceso ayuda a estimar y balancear los retardos en las rutas del clock, mitigando los efectos del skew.
- **Simulaciones Montecarlo**: Estas simulaciones permiten prever las variaciones del jitter y ajustar el dise√±o del sistema para minimizar su impacto.
- **An√°lisis t√©rmico y de alimentaci√≥n**: Evaluar las variaciones t√©rmicas y de alimentaci√≥n para dise√±ar estrategias de mitigaci√≥n adecuadas.

## Distribucion del clock
La distribuci√≥n del clock es crucial para asegurar que todos los componentes del sistema reciban se√±ales de clock sincronizadas y minimizar tanto el skew como el jitter. Un dise√±o eficiente de la distribuci√≥n del clock puede mejorar significativamente el rendimiento del sistema.
Tiene el objetivo minimizar la componente deterministica del clock skew. Estas distribuciones se realizan despues de las interconessiones con el puerto de destino

### Distribuci√≥n del clock en √°rbol
   - Enfoque en igualar los retardos relativos: Al distribuir el clock en un dise√±o en forma de √°rbol, se busca equilibrar los retardos relativos entre las diferentes ramas del √°rbol para minimizar el skew y garantizar una sincronizaci√≥n adecuada.
   - Ajuste del sizing de los buffers e interconexiones: Si las rutas de distribuci√≥n del clock no son id√©nticas, se puede ajustar el tama√±o de los buffers y las interconexiones para equilibrar los retardos y reducir el skew.
   - Basicamente, todos el mismo retardo.
   - Ocupa poca area
#### Arbol H
Se utiliza una estructura en H para balancear los retardos
![[Pasted image 20240218103912.png]]
![[Pasted image 20240218104507.png]]
###  Distribuci√≥n del clock en grilla:
   - Minimizaci√≥n del skew absoluto: La distribuci√≥n del clock en una grilla tiene como objetivo minimizar el skew absoluto al enviar la se√±al de clock desde m√∫ltiples direcciones. Esto ayuda a reducir las variaciones en los tiempos de llegada del clock a diferentes puntos del circuito.
   - Independencia de la posici√≥n de los registros: Al implementar una distribuci√≥n en grilla, se busca minimizar el impacto de la posici√≥n de los registros en los retardos del clock, lo que puede mejorar la estabilidad de la sincronizaci√≥n.
![[Pasted image 20240218104535.png]]

### Distribuci√≥n del clock en FPGA:
   - Atenci√≥n especial a la gesti√≥n del jitter y del skew: Debido a la arquitectura y configuraci√≥n de los dispositivos FPGA, es importante prestar especial atenci√≥n a la distribuci√≥n del clock para mitigar los efectos del jitter y del skew en estos dispositivos.
   - Uso de PLL para ajustar el skew: En dispositivos FPGA, se pueden utilizar PLL (Phase-Locked Loop) para ajustar el skew y mejorar la sincronizaci√≥n del clock en el circuito.







## Generacion del Clk
El clock es el coraz√≥n de cualquier sistema digital, proporcionando la se√±al de sincronizaci√≥n que coordina las operaciones de todos los componentes del sistema. Sin un clock preciso, los componentes no podr√≠an operar de manera armoniosa, lo que resultar√≠a en fallos en el procesamiento de datos.

- **Frecuencia**: La frecuencia del clock determina la velocidad a la que operan los circuitos digitales. Una mayor frecuencia permite realizar m√°s operaciones en menos tiempo, pero tambi√©n aumenta el consumo de energ√≠a y la generaci√≥n de calor.
- **Fase**: La fase del clock es crucial para la sincronizaci√≥n. Cualquier desajuste en la fase puede causar problemas de timing, conocidos como skew

### Conceptos previos importantes
#### Osciladores de Cuarzo

Un oscilador de cuarzo utiliza las propiedades piezoel√©ctricas del cuarzo para generar una se√±al de clock estable y precisa. Cuando se aplica una tensi√≥n el√©ctrica al cristal de cuarzo, este vibra a una frecuencia espec√≠fica que depende de su corte y dimensiones. Estas vibraciones se convierten en una se√±al el√©ctrica peri√≥dica que se utiliza como clock.
- **Ventajas**:
    - Alta estabilidad y precisi√≥n.
    - Baja deriva de frecuencia a lo largo del tiempo.
    - Buena inmunidad al ruido y a las variaciones de temperatura.
- **Limitaciones**:
    - Limitaci√≥n en la frecuencia m√°xima (cientos de MHz).
    - No se pueden ajustar din√°micamente para cambiar la frecuencia.
    - Generar clocks de alta frecuencia (m√°s de cientos de MHz) fuera del chip puede resultar en p√©rdida de se√±al debido a las limitaciones f√≠sicas y la disipaci√≥n de energ√≠a en las pistas del PCB.

#### Multiplicadores y Divisores de Frecuencia

Los multiplicadores y divisores de frecuencia son circuitos que ajustan la frecuencia del clock generado por el oscilador de cuarzo para adaptarse a las necesidades del sistema digital.

- **Multiplicadores de Frecuencia**: Aumentan la frecuencia del clock. Utilizados cuando se necesita una frecuencia de operaci√≥n m√°s alta que la proporcionada por el oscilador de cuarzo.
    - **PLL (Phase-Locked Loop)**: Utilizado para multiplicar la frecuencia del clock de referencia.
- **Divisores de Frecuencia**: Reducen la frecuencia del clock. Utilizados cuando se necesita una frecuencia m√°s baja para ciertas partes del circuito.
    - **Divisores de Flip-Flop**: Implementados usando flip-flops tipo T en cascada.
### PLL
![[Pasted image 20240218110031.png]]
Un PLL es un circuito que sincroniza la frecuencia y fase de un oscilador controlado (VCO) con una se√±al de referencia. Es ampliamente utilizado en sistemas digitales para generar clocks de alta frecuencia a partir de una se√±al de referencia de baja frecuencia.

- **Phase Detector (PD)**: Detecta la diferencia de fase entre la se√±al de referencia y la se√±al de feedback del VCO.
- **Charge Pump (CP)**: Convierte la diferencia de fase detectada en una corriente que ajusta la tensi√≥n del VCO.
- **Loop Filter (LF)**: Filtra la se√±al de la charge pump para suavizar la tensi√≥n de control del VCO y reducir el jitter.
- **Voltage-Controlled Oscillator (VCO)**: Genera una se√±al de frecuencia controlada por la tensi√≥n de entrada.
- **Divisor de Frecuencia**: Divide la frecuencia de la se√±al del VCO para generar la se√±al de feedback al phase detector. Si no est√° presente, se utilizan para crear dos relojes con un skew igual a 0, pero adem√°s hay este bloque para multiplicar.

![[Pasted image 20240218110045.png]]

- Si se trabaja con peque√±as se√±ales, puede ser linealizado en un entorno de la frecuencia de free running y podemos describir los bloques con una funci√≥n de transferencia y el PLL se comporta en este caso como un LP de segundo orden ü°™ para peque√±as desviaciones de la condici√≥n de enganche.
- El PLL trabaja esencialmente en las fases de las se√±ales que entran.

![[Pasted image 20240218110408.png]]


#### PD detector de fase
Compara la fase de dos se√±ales de entrada y genera una salida proporcional al desfase entre ellas. Con este tipo de circuito no logro saber si el desfase es positivo o negativo. Esto puede funcionar en ciertas circunstancias, pero con un rendimiento limitado, ya que en realidad se est√° observando un retraso y siempre se puede interpretar como un adelanto. Sin embargo, al trabajar con se√±ales peque√±as, estos desfases suelen ser peque√±os en comparaci√≥n con el valor nominal. Cuando se trabaja con desfases grandes, se pierde la linealidad.
![[Pasted image 20240218111113.png]]


#### Phase-Frequency Detector (PFD):
![[Pasted image 20240218111158.png]]
El Phase-Frequency Detector es una extensi√≥n del PD que no solo detecta la diferencia de fase entre las se√±ales de entrada, sino que tambi√©n puede detectar diferencias en la frecuencia. Esto permite al PFD controlar tanto la fase como la frecuencia del VCO de manera m√°s precisa, lo que resulta en una mejor estabilidad y rapidez en el proceso de sincronizaci√≥n.

El Phase-Frequency Detector (PFD) se implementa como una m√°quina de estados: 2 registros y una puerta l√≥gica. La salida de los dos Flip-Flops es le√≠da por la puerta l√≥gica en retroalimentaci√≥n, y la salida de la puerta l√≥gica controla el reset de los dos registros. De esta manera, se puede determinar el signo del desfase, ya que hay dos se√±ales, 'up' y 'down', que controlan la carga de la bomba de carga.





#### Charge Pump (Pompa di Carica):
Detectorde error de la phase de corriente entre 2 segnales .
Puesto que la corriente de la bomba de carga es constante tendremos que la fdt es una constante K del detector de fase.
![[Pasted image 20240218111839.png]]

#### Loop Filter (Filtro di Anello):
![[Pasted image 20240218111933.png]]
El loop filter es un componente crucial en un PLL que se encarga de garantizar la estabilidad del sistema. Se trata de un filtro pasa-bajo que genera una rampa de control para el VCO. El loop filter es fundamental para reducir el jitter del "system clock" y mantener la estabilidad del sistema de control de bucle de fase.

#### Ring-Oscillator VCO (VCO ad Anello di Oscillatore):
El VCO basado en anillo de oscilador es un tipo de oscilador utilizado en la generaci√≥n de se√±ales de reloj en circuitos integrados. Consiste en una serie de inversores en un bucle de retroalimentaci√≥n que generan una oscilaci√≥n. Este tipo de VCO es com√∫n en las bibliotecas est√°ndar de tecnolog√≠as de fabricaci√≥n y se utiliza para comparar las prestaciones de diferentes tecnolog√≠as.
![[Pasted image 20240218111949.png]]

#### Frequency Divider (Divisore di Frequenza):
El frequency divider es un componente que se utiliza para dividir la frecuencia de una se√±al de reloj. En un PLL, el frequency divider se emplea en la retroalimentaci√≥n para multiplicar o dividir la frecuencia del reloj de salida en relaci√≥n con la se√±al de referencia. Esto permite ajustar la frecuencia de la se√±al de salida seg√∫n los requisitos del sistema.


### PLL como base de distribucion de clk
La distribuci√≥n del clock utilizando PLL (Phase-Locked Loop) permite que m√∫ltiples sistemas digitales reciban se√±ales de clock que est√°n perfectamente sincronizadas en fase. Esto se logra utilizando PLLs como buffers con retardo nulo (zero delay buffers).
![[Pasted image 20240218112133.png]]
#### Funcionamiento

1. **Phase Detector (PD)**: Compara la fase de la se√±al de referencia con la se√±al de feedback y genera se√±ales de error ("up" y "down").
2. **Charge Pump (CP)**: Convierte las se√±ales de error en una corriente que ajusta la tensi√≥n de entrada del filtro de bucle.
3. **Loop Filter (LF)**: Filtra la se√±al de la charge pump para estabilizar la tensi√≥n de control del VCO.
4. **Voltage-Controlled Oscillator (VCO)**: Genera una se√±al de clock cuya frecuencia se ajusta en funci√≥n de la tensi√≥n de control.
5. **Clock Driver**: Amplifica la se√±al de clock para distribuirla al sistema digital.
### PLL como base de la sincronizacion
La sincronizaci√≥n basada en PLL se utiliza para asegurar que la se√±al de clock en un chip sea perfectamente sincronizada con la se√±al de clock en otro chip, incluso cuando los datos se transfieren a una frecuencia inferior a la del system clock. Esto es crucial en sistemas donde los datos deben ser transferidos sincr√≥nicamente entre diferentes chips.
![[Pasted image 20240218112213.png]]
#### Funcionamiento

1. **PLL en el Chip 1**: Genera un clock de sistema a partir de un oscilador de cuarzo y un divisor de frecuencia.
2. **Divisor de Frecuencia**: Genera un clock de referencia a partir del clock del sistema para transferir los datos.
3. **Transferencia de Datos**: Los datos se transfieren del Chip 1 al Chip 2 sincr√≥nicamente con el clock de referencia.
4. **PLL en el Chip 2**: Recibe el clock de referencia y lo utiliza para sincronizar su propio clock interno, anulando los efectos del retardo del buffer de clock (de-skewing).

### DLL
La generaci√≥n de reloj utilizando DLLs (Delay-Locked Loops) es un enfoque alternativo al uso de PLLs (Phase-Locked Loops) para la generaci√≥n y sincronizaci√≥n de se√±ales de reloj en circuitos integrados.

Un DLL es un circuito similar a un PLL, pero en lugar de ajustar la frecuencia de un VCO, ajusta el retardo de una l√≠nea de retardo controlada por tensi√≥n para sincronizar la fase de la se√±al de salida con la se√±al de entrada.

Un Delay-Locked Loop es un tipo de circuito de control de bucle que se basa en una l√≠nea de retardo controlada por voltaje en lugar de un oscilador controlado por voltaje. En un DLL, se busca alinear perfectamente las se√±ales de referencia y de salida (deskewing) ajustando el retardo de la l√≠nea de retardo.
#### Diferencias entre PLL y DLL

- **PLL**: Ajusta la frecuencia para sincronizar la fase y puede multiplicar la frecuencia de la se√±al de referencia.
- **DLL**: Ajusta directamente la fase mediante una l√≠nea de retardo y no puede multiplicar la frecuencia de la se√±al de referencia.

#### Componentes y Funcionamiento del DLL

- **Phase Detector (PD)**: Detecta la diferencia de fase entre la se√±al de entrada y la se√±al de salida.
- **Charge Pump (CP)**: Genera una corriente basada en la diferencia de fase.
- **Delay Line**: Una l√≠nea de retardo controlada por tensi√≥n que ajusta el retardo de la se√±al de salida para sincronizarla con la se√±al de entrada.

#### Aplicaciones del DLL en Sistemas Digitales

- **Refaseo del Clock**: Ajuste fino de la fase del clock para minimizar el skew.
- **Sincronizaci√≥n de Datos**: Sincronizaci√≥n de se√±ales de datos en interfaces de alta velocidad.
![[Pasted image 20240218112529.png]]
- No tiene un oscilador controlado por tension
- En condiciones de sincronizaci√≥n, las se√±ales de entrada y salida est√°n perfectamente alineadas en t√©rminos de fase (deskewing).
- Los DLLs no permiten la multiplicaci√≥n de la frecuencia de la se√±al de referencia, a diferencia de los PLLs.
- Los DLLs son sistemas incondicionalmente estables y tienden a tener un menor jitter en comparaci√≥n con los PLLs.

### DLL como base de distribucion del clk
![[Pasted image 20240218113511.png]]

## Sincronizacion de sitemas
La correcta sincronizaci√≥n es vital para asegurar que el sistema funcione de manera coherente y confiable, evitando errores de temporizaci√≥n y problemas de estabilidad.
### Tipos de Sistemas

#### Sistemas Sincronos
Los sistemas sincronos operan con un reloj global que coordina el funcionamiento de todos los componentes. Cada elemento del sistema realiza sus operaciones en sincron√≠a con este reloj, lo que permite una coordinaci√≥n precisa y predecible de las actividades. Estos sistemas son comunes en la mayor√≠a de los circuitos integrados debido a su simplicidad y predictibilidad.

- **Definici√≥n y Caracter√≠sticas**: Un sistema sincrono utiliza un reloj global para sincronizar todas sus operaciones. Esto asegura que todas las partes del sistema trabajen juntas de manera coordinada.
- **Ejemplos de Aplicaciones Comunes**: Microprocesadores, memorias y otros circuitos integrados digitales.

#### Sistemas Asincronos

A diferencia de los sistemas sincronos, los sistemas asincroni no dependen de un reloj global. En su lugar, las operaciones se inician y completan en funci√≥n de eventos o se√±ales espec√≠ficas. Esto puede ofrecer ventajas en t√©rminos de flexibilidad y eficiencia energ√©tica, pero tambi√©n presenta desaf√≠os significativos en t√©rminos de dise√±o y sincronizaci√≥n.

- **Definici√≥n y Caracter√≠sticas**: Un sistema asincrono opera sin un reloj global, bas√°ndose en eventos externos para iniciar y completar operaciones.
- **Ejemplos de Eventos Asincroni**: Entrada desde un teclado, se√±ales de sensores, etc.

### Sincronizaci√≥n de Sistemas

#### Sistemas Globalmente Asincroni-Localmente Sincroni (GALS)
![[Pasted image 20240720102313.png]]

Los sistemas GALS combinan lo mejor de ambos mundos, utilizando relojes locales para sincronizar operaciones dentro de peque√±os sub-sistemas, mientras permiten que estos sub-sistemas operen asincr√≥nicamente entre s√≠. Este enfoque puede mejorar la flexibilidad y la eficiencia energ√©tica, a la vez que reduce los problemas de temporizaci√≥n y skew.

- **Definici√≥n y Descripci√≥n del Funcionamiento**: Los sistemas GALS consisten en varios sub-sistemas sincronos que operan a diferentes frecuencias de reloj, pero se comunican entre s√≠ de manera asincrona. Cada sub-sistema tiene su propio reloj local.
- **Ventajas y Desventajas**: 
  - *Ventajas*: Mayor flexibilidad, eficiencia energ√©tica, reducci√≥n de problemas de skew.
  - *Desventajas*: Complejidad en el dise√±o, necesidad de mecanismos de sincronizaci√≥n adicionales.
- **Ejemplos y Aplicaciones**: Sistemas integrados en dispositivos m√≥viles, donde diferentes m√≥dulos (como CPU, GPU y m√≥dulos de comunicaci√≥n) operan a distintas frecuencias.

#### Sistema Autotemporizzato

Los sistemas autotemporizzati o self-timed operan sin un reloj global, utilizando se√±ales de completamiento y handshaking para coordinar las operaciones. Este enfoque puede mejorar significativamente la eficiencia energ√©tica y reducir el √°rea del chip dedicada a la gesti√≥n del reloj, pero requiere una circuiter√≠a adicional para manejar los mecanismos de sincronizaci√≥n.

- **Definici√≥n y Funcionamiento**: Un sistema autotemporizzato completa sus operaciones bas√°ndose en se√±ales de handshaking y completamiento, en lugar de depender de un reloj global.
- **Ventajas y Desventajas**: 
  - *Ventajas*: Ahorro de potencia, reducci√≥n del √°rea del chip, mayor tolerancia a variaciones en el proceso y temperatura.
  - *Desventajas*: Necesidad de circuiter√≠a adicional, complejidad en el dise√±o.
- **Ejemplos y Aplicaciones**: Circuitos espec√≠ficos que requieren alta eficiencia energ√©tica y tolerancia a variaciones, como ciertos m√≥dulos en sistemas integrados avanzados.


### Problema de la Metastabilidad
La metastabilidad es un estado en el que un flip-flop puede quedar atrapado en una condici√≥n intermedia entre un estado l√≥gico alto y uno bajo. Este estado indefinido puede ocurrir cuando el flip-flop recibe una se√±al de entrada asincrona o cuando los tiempos de configuraci√≥n y retenci√≥n no se cumplen adecuadamente. La salida de la metastabilidad es impredecible, tanto en t√©rminos de tiempo como de valor l√≥gico, lo que puede causar fallos en el sistema.
![[Pasted image 20240206183721.png]]
#### Modelos de Metastabilidad
- La posibilidad de metaestabilidad cuando tenemos una se√±al asincronica es 2 veces el tiempo de subida dividida en el periodo
$$P_{\epsilon}=\frac{2t_e}{T}$$
Si el clock varia con nuestra frecuencias: $N=P_{\epsilon}.f_{clk}$
Donde N es MTBF, que es una caracteristica de la calidad de nuestro sistema
$$MTBF=\frac{e^{\frac{t_{m,max}}{\tau}}}{f_{ck}.f_{signal}t_0}$$
![[Pasted image 20240720102715.png]]
Para entender y mitigar la metastabilidad, se utilizan varios modelos matem√°ticos y f√≠sicos. Un modelo com√∫n es el modelo de un solo polo para un flip-flop, que describe c√≥mo un flip-flop puede entrar y salir de un estado metastable.
$$v_q(t)=V_M+(v_a(0)-V_M).e^{\frac{t}{\tau}}$$
- **VM**: Tensi√≥n de metastabilidad.
- **v(0)**: Valor inicial de la tensi√≥n.
- **œÑ**: Constante de tiempo que var√≠a con las condiciones del proceso y ambientales (como la temperatura).

Existe una franja de valores prohibidos alrededor de $VM$, con una amplitud de $2v_Œµ$, donde el tiempo para salir de la metastabilidad (tm) excede un valor m√°ximo (tm,max), resultando en un error de sincronizaci√≥n.

Imponiendo $VM = VDD/2$ y $Vq(tm) = VDD$, el modelo predice un tiempo infinito para la salida de la metastabilidad si la entrada vale exactamente VM.

![[Pasted image 20240720103256.png]]
#### Mitigaci√≥n de la Metastabilidad

Aunque no se puede eliminar completamente el riesgo de metastabilidad, se pueden tomar medidas para reducir su probabilidad y mitigar sus efectos:

- **Uso de Flip-Flops en Cascada**: Colocar dos flip-flops en cascada puede reducir la probabilidad de que la metastabilidad afecte la operaci√≥n del sistema, a costa de un aumento en la latencia.
- **Aumento del Timing**: Ajustar los tiempos de configuraci√≥n y retenci√≥n para acomodar el peor caso de tiempo de salida de la metastabilidad puede ayudar a minimizar su impacto.

### Sincronizaci√≥n de Se√±ales Asincroni

#### 5.1. Flip-Flops como Sincronizadores

Los flip-flops son los bloques de construcci√≥n b√°sicos para sincronizar se√±ales asincroni. Se utilizan para capturar y estabilizar se√±ales que llegan en momentos no sincronizados con el reloj del sistema.

- **Uso B√°sico**: Un flip-flop simple puede sincronizar una se√±al asincrona al muestrearla en el borde del reloj del sistema.
- **Problemas Potenciales**: La violaci√≥n de constraints temporales puede llevar a la metastabilidad, donde el flip-flop no puede resolver su salida en un tiempo finito.

#### 5.2. Sincronizaci√≥n en Sistemas GALS

En los sistemas GALS, es esencial utilizar bistabili para la sincronizaci√≥n de se√±ales entre sub-sistemas que operan a diferentes frecuencias de reloj. Este enfoque permite que cada sub-sistema mantenga su propia sincronizaci√≥n local mientras se comunica de manera segura con otros sub-sistemas.

- **Bistabili para Sincronizaci√≥n**: Los bistabili se usan para capturar y sincronizar las se√±ales de entrada que provienen de otros sub-sistemas asincronos.
- **Consideraciones de Timing**: Se debe tener en cuenta un aumento en el retardo tCQ, que es el tiempo que toma para que una se√±al sea capturada y propagada a trav√©s del bistabili.



### 6. Sistemas Auto-temporizzati (Self-timed)

#### 6.1. Principios B√°sicos

Los sistemas auto-temporizzati, o self-timed, operan sin un reloj global, utilizando en su lugar se√±ales de handshaking y de completamiento para coordinar las operaciones. Esto permite que cada componente del sistema funcione a su propio ritmo, basado en la disponibilidad de datos y la finalizaci√≥n de las tareas anteriores, lo cual puede resultar en una mayor eficiencia energ√©tica y un uso m√°s efectivo del √°rea del chip.

- **Separaci√≥n entre Ordenamiento L√≥gico y F√≠sico**: Los sistemas auto-temporizzati permiten una clara distinci√≥n entre la l√≥gica del circuito y el ordenamiento f√≠sico de sus componentes.
- **Consideraci√≥n del Ritardo como Media**: En lugar de dise√±ar en funci√≥n del peor caso de retardo, estos sistemas consideran la media de los retardos, lo cual puede llevar a un dise√±o m√°s eficiente.
- **Ahorro de Potencia y √Årea**: Al eliminar la necesidad de un reloj global, se reduce el consumo de energ√≠a y el √°rea dedicada a la distribuci√≥n del reloj en el chip.
- **Circuiteria Adicional para Sincronismo**: Se requiere circuiter√≠a adicional para manejar las se√±ales de sincronismo y handshaking.

#### 6.2. M√≥dulo de Ritardo

En los sistemas auto-temporizzati, los m√≥dulos de ritardo son cruciales para asegurar que las se√±ales se propaguen correctamente y sin desalineaciones.

- **Portelogiche Fittizie**: Estas puertas l√≥gicas artificiales tienen el mismo retardo cr√≠tico que la red l√≥gica y se posicionan cerca de la red para evitar desalineaciones debido a variaciones de temperatura o proceso.

#### 6.3. Ejemplo: Self-Timed Adder

Un ejemplo de sistema auto-temporizzato es un sumador auto-temporizado, que opera de manera eficiente coordinando las operaciones a trav√©s de se√±ales de handshaking.

- **Generaci√≥n Diferencial del Carry**: Este enfoque reduce el tiempo cr√≠tico del carry al modificar la cadena de carry de Manchester.
- **Sensing de Corrente para Se√±al de Completamento**: Utiliza la detecci√≥n de corriente para generar se√±ales de completamiento, asegurando que las operaciones se completen antes de pasar a la siguiente etapa.
- **Mindelay Generator**: Este componente evita bloqueos en caso de que la l√≥gica no conmute adecuadamente.

### 7. Protocolos Hand-Shaking

#### 7.1. Handshake a Dos Fasi

El protocolo de handshake a dos fases es una t√©cnica de sincronizaci√≥n utilizada para coordinar la comunicaci√≥n entre un emisor y un receptor mediante se√±ales de solicitud (Req) y reconocimiento (Ack).

- **Configuraci√≥n Sender-Receiver**: El emisor y el receptor intercambian se√±ales de Req y Ack para iniciar y completar la transferencia de datos.
- **Descripci√≥n del Diagrama Temporal**:
  - *Ciclo 1*: El emisor env√≠a una se√±al de solicitud (Req).
  - *Ciclo 2*: El receptor responde con una se√±al de reconocimiento (Ack), indicando que ha recibido y procesado la solicitud.

#### 7.2. Handshake a Cuatro Fasi

El protocolo de handshake a cuatro fases utiliza un ciclo de cuatro pasos para sincronizar las operaciones, proporcionando una gesti√≥n robusta y flexible de los se√±ales de completamento.

- **Ventajas**: Este protocolo es m√°s robusto y tolerante a fallos, proporcionando una sincronizaci√≥n m√°s fiable en sistemas complejos.
- **Desventajas**: Puede ser m√°s lento y consumir m√°s recursos en comparaci√≥n con el protocolo de dos fases.

#### 7.3. Ejemplo de FIFO Auto-temporizzato

Un FIFO auto-temporizzato utiliza protocolos de handshake para gestionar la transferencia de datos entre etapas, asegurando que cada etapa est√© completa antes de pasar a la siguiente.

- **Indicadores de Pipeline Vac√≠o y Lleno**:
  - *Pipeline Vac√≠o*: Todos los bits son 1 o 0.
  - *Pipeline Lleno*: Los bits alternan entre 1 y 0.

Estos indicadores permiten una gesti√≥n eficiente del flujo de datos, asegurando que el sistema opere de manera √≥ptima y sin interrupciones.
