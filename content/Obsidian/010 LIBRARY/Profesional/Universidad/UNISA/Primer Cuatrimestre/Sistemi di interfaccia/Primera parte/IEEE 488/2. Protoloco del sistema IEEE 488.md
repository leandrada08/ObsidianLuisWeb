---
cards-deck: Profesional::Universidad::UNISA::Sistemi di interfaccia::IEEE 488
---



# Protocolo IEEE 488 Italiano


## Temporizzazione della comunicazione #tarjeta-anki 
L'handshake é realizzato mediante una succesione di commutazioni degli stati logici delle linee NRFD,DAV e NDAC del bus che si svolge in base ad una sequenza predeterminata
1. La interfaccia della periferica sorgente della comunicazione mantiene la linea DAV allo stato "falso" e controlla, al tempo t2, lo stato della linee NRFD e NDAC.
2. Nel franttempo le diverse interfacce delle periferiche in ricezione si preparano al loro compito e ciascuano impone lo stato logico "falso" al proprio bus driver relativo alla linea NRFD. Questo dirá che sono pronti a ricevere dati
3. Al tempo t3 la prima interfaccia é pronta e "rilascia" NRFD, ma l'uso di una linea party-line, della struttura wired-OR e della logica negata fanno si che NRFD assuma lo stato logico "falso" solamente queando tutti i bus driver hanno raggiunto tale stato
4. La interfaccia da cui ha origine la trasmissione inizia a configurare gli state delle linee DI01-8
5. Lúltima interfaccia in recezione diventa pronta a ricevere il carattere corrente ed il corrispondente bus driver assume lo stato logico "falso": a questo istante, perció, avviene la commutazione della linea NRFD. Questo evento provoca l'inizio della trasmissione vera e propria del byte che rappressenta il carattere corrente
6. Recepita la commutazione della linee NRFD l'interfaccia del trasmettitore ordina si ricevitori di acquisire il carattere. Per fare questo esso porta la linea DAV allo stato logico "vero" attraverso il relativo bus driver
7. Le interfacce in ricezione inizia la fase di acquisizione del dato e comiunica alla sorgente dell'informazione il proprio stato di occupazione agendo sulla linea NRFD. La linea, quindi, asume lo stato "vero" ed inibisce la trasmissione di ulteriori caratteri
8. Con un ritardo variable da periferica a periferica, le interfacce agiscono poi sui bus driver della linea NDAC portandoli allo stato logico "falso" per comunizare il completamento della fase di acquisizione.
9. La linea NDAC resta allo stato logico "vero" fino a quando anche l'ultima interfaccia non ha completato l'acquisizione del dato. Luego, NDAC assume il valore "falso". Poinche tutte le periferiche hanno ricevuto il dato corrente, la interfaccia sorgente della comunicazione puó procedere con la trasmisione.
10. L'interfaccia sorgente della comunicazione porta allo stato logico "falso" la linea DAV per segnalare che le informazioni presenti sul data bus non sono piú da considerarsi valide ed inizia a riconfigurare le linee DI01-8 in conformita al nuevo byte da trasmettere
11. In conseguenza della transizione della linea DAV la interfaccia del riceptore piú veloce, preparandosi per la succesiva fase di acquisizione, provoca la transizione di NDAC allo stato "vero"
12. Il ciclo di transmission e temporizzacione puó quindi ripetersi, una volta per ogni carattere trasmettere
![[Pasted image 20231101203707.png]]
![[Pasted image 20231101203709.png]]
- E'stato segnalato che la procesura di handshake provoca l'adattamento automatico della velocitá di trasmissione a quella della periferica piú lenta: per tale motivo, ed allo scopo di mantenere comunque la velocitá al valora piú alto possibile, alla procedura di hanshake non partecipano indistintamente tutte le periferiche, ma vigono delle regole particolari.
^1705869526411








## Protocollo di trasmissione #tarjeta-anki 
Questo protocollo prevede diverse fasi a seconda che la trasmissione consista in comandi diretti dal controllore o in dati provenienti da un dispositivo periferico che funge da locutore
### Invio di comandi indirizzati per il controller
- Il controller devi portá  la linea ATN allos tato logico *vero* per attivare del mode command
- Selezione delle interfacce che dovranno ricevere la comunicazione, questo consiste nell'indirizzamento delle periferiche da comandare, attivandone il funzionamento como listener
- Il controllore trasmette gli indirizzi di ascolto delle interface degli strumenti che riceveranno i comandi sulle linee del bus dati. Questo garantisce che solo i dispositivi indirizzati ricevano i caratteri della trasmissione
- Il controllore inizia a trasmettere i comandi diretti agli asoltatori selezionati
### Invio di dati da un dispositivo periferico
- Il controllore acttiva la funzione di ascolto nelle interfacce che riceveranno la comunicazione, simile alla fase dei comandi diretti
- Il controllore seleziona il dispositivo che fungerá da locutore e trasmette il suo indirizzo di conversazione attraverso il bus dati
- Il controllore cambia la linea ATN allo stato logico *falso*, avviando cosi la modalitá di dati. Il locutore selezionato inizia a tramettere dati sulle linee del bus dati, e solo i dispositivi periferici configurati como ascoltatori partecipano alla sincronizzazione della comunicazione
### Fine della trasmissione
Per segnalare la fine della trasmissione, il controllore e il locutore possono utilizzare due procedure:
1. **Linea EOI:** Il locutore utilizza la linea EOI come ““linea de interruzione”” per informare il controllore della fine della trasmissione.
2. **Terminatore:** Il locutore puó trasmettere una sequenza epdefinita di caratteri, chiamata ““terminatore’‘’, alla fina dei dati trasmessi
^1705869526418



## Indirizzamento

### Indirizzamento delle periferiche
É necessaria una funzione che permetta di selezionare sia le interfacce che devono ricevere i dati, sia quellla che deve trasmetterli. La procedura con cui viene effettuata la selezione prende il nome di *indirizzamento* in quanto basata sull'uso di un codice identificativo, detto *indirizzo*, assegnato all'interfaccia di ogni periferica.
- L'indirizzo di ogni interfaccia collegata al bus IEEE 488 é cocostituito da un caracttere a cinque bit.
- Nella linee DI01-5, codice corrispodente al indirrizo
- 1111 é riservato per indicare stato di latenza
- La informazione richiesta viene codificata mediante i due bit tramessi contemporaneamente al codice di indirizzo sulle linee DI06-7.
	- *Talker:* DI06=0 e DI07=1
	- *Listener:* DI06=1 e DI07=0
	- Comandos *Talk address(TAD)* e *Listen addres(LAD)*
- Usualmente i due codici di indirizzo descritti vengono considerati assimilabili a "comnadi", essi sono indicati come **comandi di deselezione**. Il primo corrisponde al comando *untalk(UNT)* ed il secondo al comando *unlisten(UNL)*. 

### Indirizzi estesi ed indirizzi secondari
- Alcune periferiche possono essere previste per operare in base a "partizioni interne"
- La procedura di trasmissione dell'indirizzo esteso prevede che il controller, in luego della convezionale trasmissione del carattere corrispondente al talk address primario(TAD) ovvero al listen addres primario(LAD), esegua la trasmissione di due caratteri dei queli il primo é ancora l'indirizzo primario della interfaccia ed il secondo é un caracttere che individua la partizizione desiderata della periferica. Questo carattere ausiliario, detto "indirizzo secondario", ha la caratteristica di avere i bit 6 e 7 (linee DI06-7) allo stato logico "1"


## Dati e comandi
Sia i dati che i comandi, quindi, vengono codificati con caratteri ASCII trasmessi mediante le stesse linee(DI01-DI08) ed é indispensabili una informazione supplementare che consenta alle interfacce di riconocere se i caratteri presenti sul bus rappesentano dati ovvero comandi: tale informazione viene fornita dallo stato logico della linea ATN(attention) di general interface management.
Questa linea, che viene comandata esclusivamente dal controllore, assume lo stato logico "falso" quenado i caratteri presenti sul data bus corrispondono a dati trasferiti dal talker ai listener. Lo stato logico "vero" di ATN segnala invence che i caratteri sono da considerare comandi trasmessi dal controllore alle interfacce delle perferiche, il sistema IEEE 488 ha quindi due regimi di funzionamente *command mode* e *data mode*, si differenziano a seconda dello stato logico della linea ATN.


### True/False Attention

#### True-Attention
Modalità "True-Attention" (Vera Attenzione): In questa modalità, il "source-handshake" è il controllore, e gli "acceptor-handshake" sono tutti i dispositivi collegati al bus. Ciò significa che il controllore avvia la comunicazione e stabilisce la connessione con tutti i dispositivi nel bus.

#### False-Attention
Modalità "False-Attention" (Falsa Attenzione): In questa modalità, il "source-handshake" è il "talker" o il parlante, e gli "acceptor-handshake" sono i "listener" o gli ascoltatori. Quando l'attenzione è falsa, è il "talker" che avvia la comunicazione, mentre i "listener" ascoltano ciò che viene trasmesso.


#### Source-Handshake
Funzione "Source-Handshake": In questo contesto, "source" si riferisce alla parte che avvia la comunicazione o l'azione, e "handshake" è un processo in cui due parti stabiliscono una connessione o concordano su determinati parametri prima di comunicare o scambiare dati.

Nella modalità "True-Attention," il "source-handshake" è il controllore. Ciò significa che il controllore, in questa configurazione, è la parte che avvia la comunicazione e controlla il processo di stretta di mano con tutti i dispositivi nel bus.

Nella modalità "False-Attention," il "source-handshake" è il "talker" o il parlante. Ciò suggerisce che quando l'attenzione è falsa, il "talker" assume il ruolo principale nella conversazione o interazione ed è responsabile della trasmissione delle informazioni.



### Comandi universali #tarjeta-anki 
Questi comandi vengono tramessi dal controller e ricevuti da tutte le interfacce connesse al bus. I comandi universali sono 8: di questi, 3 sono comandi unilinea a 5 sono comandi multilinea.
#### Comandi universali unilinea
- *ATN:* Attention
- *REN:* Remote enable
- *IFC:* Interface clear
Per la loro trasmissione non é richiesto lo svolgimento di una fase di handshakee
##### REN: Remote Enable
Si é "vero" l'indirizzamento delle periferiche fa si che esse disabilitino il pannello di controllo di cui sono dotate, queando esso é attivo periferiche si predispogono a ricevere i comandi che regolano il loro funzionamento tramite le interfacce connesse al bus.
Si é "falso" le periferiche abbandonano il modo remote e riassumono il modo di funzionamento "local" potendo cosi essere programmate manualmente
##### IFC: Interface Clear
Il comando provoca la interrupzione di qualsiasi azione delle interfacce che si riportano in una condizione predeterminata nella definizione dello standar IEEE 488. Le interface del talker e dei listener precedentemente indirizzati, infatti, abbandonano lo stato di attivitá assumendo quello di attesa ed il sistema assume il regime di funzionamento commando mode.
#### Comandi universali multilinea
Sono 5. Trasmessi dal controller durante il funzionamento command mode, cioé con la linea ATN allo stato logico "vero". Viene effetuata mediante la linee DI01-7 del data bus coinvolgente tutte le periferiche collegate al bus nella procedura di handshake.
##### Struttura dei comando multilinea
- I comandi universali multilinea e quelli indirizzati vengono codificati con caratteri ASCII in cui i bit 7 e 6 sono nello stato logico "00".
- I comandi di deselezione e gli indirizzi principali vengono codificati utilizzando caratteri in cui tali bit sono nella configurazione "10" (attività negli speaker) o "01" (attività negli ascoltatori).
- Le direzioni secondarie vengono codificate utilizzando caratteri in cui i bit 7 e 6 sono nello stato logico "11".
##### DCL: Device Clear
- Codificato ASCII: DC4
Tutte le periferiche connesse assumono uno stato predeterminato. Tale state non viene stabilito dallo standard IEEE 488.1 ed é pertanto variabile da periferica a periferica.
##### LLO: Local Lockout
- Codificato ASCII: DC1
Disabilita la funzione di un pulsante di comando solitamente presente sulle periferiche allo scopo di permettere la programmazione delle stesse dal proprio pannello di comando
##### SPE,SPD: Serial Poll Enable e Serial Poll Disable
- Codificato ASCII: CAN e EM
Il primo attiva una particolare funzione diagnostica esesguibile da alcune interfacce delle periferiche ed il secondo la disattiva.
##### PPU: Parallel Poll Unconfigure
- Codificato ASCII: NAK
Pone fine ad un'altra funzione diagnostica che viene indicata come "parallel poll"
^1705869526422



#### Richiesta di servizzio #tarjeta-anki 
Alcune interfacce periferiche hanno la capacitá di effettuare una ‘‘richiesta di servizio’’ al controllore. Ció viene realizzato cambiando lo stato della linea SRQ(Service request) a ‘‘vero’’. Il controllore rileva questa richiesta campionando la condizione della linea SRQ.
La richiesta di servizio é importante per i dispositivi periferici perche consente loro di interrompere l’attivitá del controllore in modo asincrono, anche quando l’interferfaccia non é abilitata per comunicare attracerso il bus dati. Le cause di tali richieste possono variare,da condizioni anomale che potrebbero influire sul funzionamento del sistema a situazoini specifiche nel sistema.
##### Procedure di interrogazione
Perche il controllore puó determinare direttamenet quale dispositivo periferico ha generato la richiesta di servizio, fare un processo che comunemente chiamato ‘'sondaggio'’.
Esistono il ‘‘sondaggio seriale’’ e ‘‘sondaggio parallelo’’
**Sondaggio Paralleo:** In questo, il controllore interroga a tutti i dispositivi periferici contemporaneamente e puó identificare quale di essi ha attivato la linea SRQ. É piu rapido, ma non é altrettanto preciso nell’identificazione del dispositivo periferico specifico che ha generato la richiesta di servizio
**Sondaggio Seriale:** In questo, il controllore interroga ciascun dispositivo periferico un per uno per indentificare queala di essi ha generato la richiesta di servizio. Queste processo é piú lento, ma é utile per una diagnosi precisa
###### Sondaggio Seriale
La procedura di interrogazione seriale (o "sondaggio seriale") viene eseguita dal controllore, che attiva la modalità di comando nel sistema. In questo processo, il controllore indirizza successivamente le diverse interfacce collegate al bus e riceve da ciascuna di esse una risposta sotto forma di un "byte di stato", che riassume le condizioni di funzionamento di quel dispositivo periferico.
Il sondaggio seriale viene attivato tramite la trasmissione del comando universale multiriga "serial poll enable" (SPE). Dal momento in cui viene inviato il comando SPE fino alla trasmissione del comando complementare "serial poll disable" (SPD), ciascun dispositivo periferico può funzionare come mittente nei livelli T1, T2, T5 e T6 (o i livelli corrispondenti TE1, TE2, TE5 e TE6 nel caso dei dispositivi periferici con indirizzo secondario). Risponde alla trasmissione del suo indirizzo di conversazione TAD con un carattere che descrive il suo stato operativo.
Lo standard IEEE 488 specifica che il dispositivo periferico che ha attivato la linea SRQ deve trasmettere il carattere con il settimo bit in stato logico "vero", noto come RQS, che viene trasmesso sulla linea DIO7. Gli altri bit del carattere di stato vengono utilizzati per descrivere la causa della richiesta di servizio, codificata in modo variabile in base al tipo di dispositivo periferico. Il controllore deve decodificare le informazioni nelle risposte dei dispositivi periferici per identificare sia il dispositivo che la causa della richiesta di servizio.
![[Pasted image 20240120165804.png]]
###### Sondaggio parallelo
D'altra parte, la procedura di "sondaggio parallelo" non consente una diagnosi dettagliata sullo stato di funzionamento dei dispositivi periferici. Consente solo di esaminare fino a 8 dispositivi periferici contemporaneamente, ma è notevolmente più veloce. Ciascuna interfaccia risponde al controllore informando il suo "bit di stato" (RQS) su una linea di dati del bus. Il controllore deve configurare preventivamente i dispositivi periferici per eseguire la procedura di interrogazione prima di attivare il sondaggio parallelo. Ciascuna interfaccia è configurata per rispondere su una linea specifica del bus di dati. Ciò consente al controllore di identificare l'interfaccia che ha attivato la richiesta di servizio. La trasmissione del comando "parallel polling unconfigure" (PPU) provoca la perdita della configurazione e i dispositivi periferici devono essere nuovamente configurati se è necessaria una nuova sessione di sondaggio parallelo.
![[Pasted image 20231103162412.png|400]]
![[Pasted image 20231103162425.png|400]]
^1705869526427



### Comandi Indirizzati #tarjeta-anki 
Sono 5 e costituiscono un insieme particolare dei comandi multilinea
La loro tramissione richiede due fasi successive: il controller deve preliminarmente indirizzare tramite i listen addres LAD le periferiche a cui il comando é destinato e in seguito, sempre in funzionamento command mode, trasmettere il carattere ASCII corrispondente al comando desiderato
#### GET: Group Execute Trigger
- ASCII: BS
Impone alle periferiche precedentemente indirizzate línizio dela esecuzione della funcione correntemente selezionata.
#### GTL: Go To Local
- ASCII: SOH
Provoca la transizione delle sole periferiche indirizzate dallo stato remote a quello local riabilitando quindi il pannello di comando degli strumenti selezionati
#### SDC: Selected Device Clear
- ASCII: EOT
Con tale comando il controller causa la assunzione di una configurazione predeterminata da parte delle periferiche selezionate, l'azione, cosí come lo stato assunto dalle periferiche, é uguale a quella conseguente alla trasmissione del comando multilinea DCL, ma interessa i soli listener selezionato
#### TCT: Take Control
- ASCII: HT
Il controller in charge cede il propio ruole ad un altro controller
#### PPC: Parallel Poll Configure(PPE)
- ASCII: ENQ
É usato dal controller per approntare una periferica per la esecuzione di una funzione diagnostica chiama "parallel pol"
#### PPD Parallel Poll Disable 
disabilita il singolo dispositivo a un parallel polling a rispondere ad un parallel polling: indirizzo primario poi PPC e poi PPD. Dopodichè chiedo a tutti di rispondere tranne quello che ho deciso di escludere.
Abbiamo visto come si deve configurare il parallel polling. Il serial poll si è chiuso dopo l'enable. Quella parallela, mi serve che loro scrivono il bit e il controller lo deve leggere. Siamo in modalità atn uguale true perchè siamo ancora con comandi di interfaccia. Rimanendo in questa modalità il controller usa un comando uni-linea per farli rispondere EOI : che in modalità true significa identify.
^1705869526431



## Struttura dei messagi
I messaggio che vengono trasmessi tramite il bus, possono essere costituiti da comandi per le interfacce ovvero da comandi e dati scambiati fra le periferiche
- Gli interfacce message devono sottostare a quelle convenzioni indicate nello standar e giá illustrate, al contrario i device dependent message non sono codificati ed é lasciata ai progettisti delle periferiche la libertá di definire strutture e forme di questi messagi
- El messaggi di dispositivi, sono messaggi trasmessi tra i dispositivi(ad esempio, valori di variabili da misurare)
- El messaggi di interfacce, sono dettati dalle norme e utilizzati per il correto funzionamento del proceso(chi agisce come controllore, talker o listener, quanto é consentito parlare, ecc)


### Instruzioni di programazzione
Le istruzioni di programmazione, che verranno dettagliate nel capitolo 6, trasmettono i comandi utilizzati per attivare il controllo delle funzioni dei dispositivi periferici. Questi messaggi sono composti da gruppi di caratteri, che, quando vengono ricevuti dai dispositivi periferici, configurano i loro parametri operativi, determinando, ad esempio, il tipo di funzione da eseguire, la portata, il valore di una quantità da generare. Si è diffuso l'uso di codificare questi comandi tramite codici alfanumerici formati da una o due lettere seguite da un numero: il prefisso alfabetico identifica la funzione su cui si agisce, il numero codifica il valore da configurare. Per agevolare l'uso del sistema, si cerca di utilizzare una codifica che consenta una facile interpretazione del comando, e di conseguenza, le differenze tra strumenti equivalenti, anche di diversi produttori, sono modeste.

### Dati da visualizzare
I dati da mostrare sono caratteri che corrispondono a testi o dati che il dispositivo periferico ricevente deve mostrare attraverso un dispositivo di uscita (monitor, display, stampante) o memorizzare. Questi messaggi vengono trasmessi esclusivamente utilizzando il set di caratteri ASCII stampabili, ovvero i caratteri compresi tra 32 e 127 nella tabella ASCII. Tra di essi ci sono tutte le lettere dell'alfabeto (maiuscole e minuscole), numeri arabi, segni di punteggiatura, segni di operazioni aritmetiche e altri simboli grafici. In questo modo, i messaggi vengono trasmessi, carattere per carattere, in una sequenza ordinata. La fine della comunicazione può essere segnalata indifferentemente sia mediante la commutazione della linea EOI che mediante la trasmissione di un terminatore composto da caratteri ASCII non inclusi nel set di caratteri stampabili, ad esempio | RC | e | LF |.

### Risultati di misura
Il gruppo dei risultati delle misurazioni include tutti quei messaggi con cui gli strumenti analitici comunicano i numeri che rappresentano i risultati delle misurazioni effettuate. Esistono due strutture tipiche di queste comunicazioni, che differiscono a seconda che i valori vengano trasferiti in forma binaria o decimale.

Nel primo caso, vengono riconosciuti i messaggi trasmessi da quei dispositivi che codificano il risultato della misura, ottenuto mediante processi di discretizzazione, come un numero binario di 8 o 16 bit. Utilizzando un codice a 8 bit, è possibile riconoscere 256 livelli discreti, che aumentano a 65.536 con l'uso della rappresentazione a 16 bit.

Pertanto, la codifica ha il vantaggio di consentire una rappresentazione molto "densa" dei valori numerici trasferiti e, grazie alla sua capacità di comprimere una grande quantità di informazioni in pochi caratteri, è particolarmente adatta per il trasferimento di informazioni che comprendono una quantità significativa di valori numerici discreti.

D'altra parte, questi strumenti di solito utilizzano la codifica decimale, tra cui multimetri, frequenzimetri e contatori, che trasmettono il risultato delle loro misurazioni attraverso una sequenza di caratteri ASCII che formano un numero decimale.
# Protocolo IEEE 488 Español
## Temporización de la Comunicación 
El handshake se realiza mediante una sucesión de conmutaciones de los estados lógicos de las líneas NRFD, DAV y NDAC del bus, que ocurre en base a una secuencia predeterminada.
1. La interfaz de la periférica que es la fuente de la comunicación mantiene la línea DAV en estado "falso" y, al tiempo t2, verifica el estado de las líneas NRFD y NDAC.
2. Mientras tanto, las diversas interfaces de las periféricas receptoras se preparan para su tarea, cada una imponiendo el estado lógico "falso" en su propio bus driver relativo a la línea NRFD. Esto indica que están listas para recibir datos.
3. En el tiempo t3, la primera interfaz está lista y "libera" NRFD, pero el uso de una línea party-line, la estructura wired-OR y la lógica negada hacen que NRFD solo asuma el estado lógico "falso" cuando todos los bus drivers han alcanzado ese estado.
4. La interfaz desde la cual se origina la transmisión comienza a configurar los estados de las líneas DI01-8.
5. La última interfaz receptora se prepara para recibir el carácter actual y su bus driver correspondiente asume el estado lógico "falso": en este momento, por lo tanto, se produce la conmutación de la línea NRFD. Este evento inicia la transmisión real del byte que representa el carácter actual.
6. Después de la conmutación de las líneas NRFD, la interfaz del transmisor ordena a los receptores que adquieran el carácter. Para hacer esto, lleva la línea DAV al estado lógico "verdadero" a través de su bus driver correspondiente.
7. Las interfaces receptoras comienzan la fase de adquisición de datos y comunican a la fuente de información su estado de ocupación actuando sobre la línea NRFD. La línea, por lo tanto, asume el estado "verdadero" e inhibe la transmisión de caracteres adicionales.
8. Con un retraso variable de una periférica a otra, las interfaces luego actúan sobre los bus drivers de la línea NDAC llevándolos al estado lógico "falso" para comunicar la finalización de la fase de adquisición.
9. La línea NDAC permanece en estado lógico "verdadero" hasta que incluso la última interfaz ha completado la adquisición de datos. Luego, NDAC asume el valor "falso". Una vez que todas las periféricas han recibido el dato actual, la interfaz fuente de la comunicación puede proceder con la transmisión.
10. La interfaz fuente de la comunicación lleva la línea DAV al estado lógico "falso" para indicar que la información presente en el bus de datos ya no debe considerarse válida y comienza a reconfigurar las líneas DI01-8 de acuerdo con el nuevo byte a transmitir.
11. Como resultado de la transición de la línea DAV, la interfaz del receptor más rápido, preparándose para la próxima fase de adquisición, provoca la transición de NDAC al estado "verdadero".
12. El ciclo de transmisión y temporización puede repetirse, una vez por cada carácter transmitido.

![Imagen1](Pasted%20image%2020231101203707.png)
![Imagen2](Pasted%20image%2020231101203709.png)

- Se ha señalado que el procedimiento de handshake provoca el ajuste automático de la velocidad de transmisión a la de la periférica más lenta: por esta razón, y con el fin de mantener la velocidad al valor más alto posible, no todas las periféricas participan indiscriminadamente en el procedimiento de handshake, sino que se aplican reglas particulares.

## Protocolo de Transmisión
Este protocolo tiene varias fases según si la transmisión consiste en comandos directos del controlador o en datos provenientes de un dispositivo periférico que actúa como locutor.

### Envío de comandos dirigidos del controlador
- El controlador debe llevar la línea ATN al estado lógico *verdadero* para activar el modo command.
- Selección de las interfaces que recibirán la comunicación, esto implica la direccionamiento de las periféricas a controlar, activando su funcionamiento como listener.
- El controlador transmite las direcciones de escucha de las interfaces de los instrumentos que recibirán los comandos en las líneas del bus de datos. Esto garantiza que solo los dispositivos direccionados reciban los caracteres de la transmisión.
- El controlador comienza a transmitir los comandos dirigidos a los oyentes seleccionados.

### Envío de datos desde un dispositivo periférico
- El controlador activa la función de escucha en las interfaces que recibirán la comunicación, similar a la fase de comandos directos.
- El controlador selecciona el dispositivo que actuará como locutor y transmite su dirección de conversación a través del bus de datos.
- El controlador cambia la línea ATN al estado lógico *falso*, iniciando así el modo de datos. El locutor seleccionado comienza a transmitir datos en las líneas del bus de datos, y solo los dispositivos periféricos configurados como oyentes participan en la sincronización de la comunicación.

### Fin de la transmisión
Para indicar el final de la transmisión, el controlador y el locutor pueden utilizar dos procedimientos:
1. **Línea EOI:** El locutor utiliza la línea EOI como "línea de interrupción" para informar al controlador del final de la transmisión.
2. **Terminador:** El locutor puede transmitir una secuencia definida de caracteres, llamada "terminador", al final de los datos transmitidos.

### Direccionamiento
#### Direcciones de las Periféricas
Es necesario tener una función que permita seleccionar tanto las interfaces que deben recibir los datos como aquellas que deben transmitirlos. El procedimiento mediante el cual se realiza esta selección se llama *direccionamiento* ya que se basa en el uso de un código identificativo, llamado *dirección*, asignado a la interfaz de cada periférica.
- La dirección de cada interfaz conectada al bus IEEE 488 consta de un carácter de cinco bits.
- En las líneas DI01-5, se encuentra el código correspondiente a la dirección.
- 1111 está reservado para indicar el estado de latencia.
- La información requerida se codifica mediante los dos bits transmitidos simultáneamente al código de dirección en las líneas DI06-7.
  - *Talker:* DI06=0 y DI07=1
  - *Listener:* DI06=1 y DI07=0
  - Comandos *Talk address (TAD)* y *Listen address (LAD)*.
- Por lo general, los dos códigos de dirección descritos se consideran asimilables a "comandos"; se les conoce como **comandos de deselección**. El primero corresponde al comando *untalk (UNT)* y el segundo al comando *unlisten (UNL)*.

#### Direcciones Extendidas y Direcciones Secundarias
- Algunas periféricas pueden estar diseñadas para operar en base a "particiones internas".
- El procedimiento para la transmisión de la dirección extendida implica que el controlador, después de la convencional transmisión del carácter correspondiente al talk address primario (TAD) o al listen address primario (LAD), realice la transmisión de dos caracteres, donde el primero sigue siendo la dirección primaria de la interfaz y el segundo es un carácter que identifica la partición deseada de la periférica. Este carácter auxiliar, llamado "dirección secundaria", tiene la característica de tener los bits 6 y 7 (líneas DI06-7) en estado lógico "1".


## Datos y Comandos
### Modos
#### Modo comando y modo dato
Tanto los datos como los comandos se codifican con caracteres ASCII transmitidos a través de las mismas líneas (DI01-DI08), y es indispensable una información adicional que permita a las interfaces reconocer si los caracteres presentes en el bus representan datos o comandos: esta información proviene del estado lógico de la línea ATN (atención) del manejo general de la interfaz.

Esta línea, comandada exclusivamente por el controlador, asume el estado lógico "falso" cuando los caracteres presentes en el bus de datos corresponden a datos transferidos del "talker" a los "listener". El estado lógico "verdadero" de ATN señala, en cambio, que los caracteres deben considerarse como comandos transmitidos por el controlador a las interfaces de las periféricas. El sistema IEEE 488 tiene, por lo tanto, dos regímenes de funcionamiento: **command mode** y **data mode**, que difieren según el estado lógico de la línea ATN.

#### Modo Remoto y local
El modo remoto se solicita con REN=true, lo mismo esto es condicion necesaria pero no suficiente, despues el dispositivo tiene que ver en la linea su codigo listener o talker en las lineas mientras ATN es false

#### True/False Attention

##### True-Attention
Modo de "True-Attention" (Atención Verdadera): En este modo, el "source-handshake" es el controlador, y los "acceptor-handshake" son todos los dispositivos conectados al bus. Esto significa que el controlador inicia la comunicación y establece la conexión con todos los dispositivos en el bus.

##### False-Attention
Modo de "False-Attention" (Atención Falsa): En este modo, el "source-handshake" es el "talker" o el hablante, y los "acceptor-handshake" son los "listener" o los oyentes. Cuando la atención es falsa, es el "talker" el que inicia la comunicación, mientras que los "listener" escuchan lo que se transmite.

##### Source-Handshake
Función de "Source-Handshake": En este contexto, "source" se refiere a la parte que inicia la comunicación o la acción, y "handshake" es un proceso en el cual dos partes establecen una conexión o acuerdan ciertos parámetros antes de comunicarse o intercambiar datos.

En el modo de "True-Attention," el "source-handshake" es el controlador. Esto significa que el controlador, en esta configuración, es la parte que inicia la comunicación y controla el proceso de estrechamiento de manos con todos los dispositivos en el bus.

En el modo de "False-Attention," el "source-handshake" es el "talker" o el hablante. Esto sugiere que cuando la atención es falsa, el "talker" asume el papel principal en la conversación o interacción y es responsable de la transmisión de la información.

### Relacionando los conceptos con chat gpto
**Modo Comando y Modo Data:**
El IEEE 488.1 utiliza un sistema de comunicación basado en modos, que son dos estados en los que pueden estar los dispositivos conectados al bus. El Modo Comando es donde se transmiten instrucciones y comandos entre el controlador y los dispositivos, mientras que el Modo Data se utiliza para la transmisión de datos.

- **Modo Comando:** En este modo, el controlador envía comandos a los dispositivos, y estos responden de acuerdo con sus capacidades. Los comandos pueden ser tanto unilineales como multilineales. Los comandos unilineales son simples y se ejecutan en un solo paso, mientras que los comandos multilineales involucran una secuencia de acciones.

- **Modo Data:** Aquí, los dispositivos transmiten y reciben datos, como valores de medición o información. El modo data es donde ocurre la transferencia de datos reales entre el controlador y los dispositivos.

**Comandos Universales (Unilineales y Multilineales):**
Los comandos universales son instrucciones que se envían a todos los dispositivos conectados al bus, y es responsabilidad de cada dispositivo decidir si puede o debe actuar según ese comando.

- **Comandos Unilineales:** Estos son comandos simples que se ejecutan en un solo paso. Cuando se envía un comando unilineal, todos los dispositivos conectados al bus lo reciben, pero solo los dispositivos capaces de interpretarlo lo ejecutan. Pueden desencadenar acciones inmediatas o cambiar el estado de un dispositivo.

- **Comandos Multilineales:** Son comandos más complejos que requieren una secuencia de acciones. Se envían en varios pasos, y cada dispositivo responde a cada paso de acuerdo con sus capacidades. Esto permite realizar operaciones más complejas y controlar dispositivos de manera más precisa.

**Comandos Indirizados:**
A diferencia de los comandos universales, los comandos indirizados se envían a dispositivos específicos utilizando sus direcciones de escucha (LAD). Esto significa que solo los dispositivos seleccionados ejecutan estos comandos. Los comandos indirizados son útiles cuando se necesita una interacción precisa con dispositivos específicos.

**Estructura de Comandos Multilineales:**
La estructura de comandos multilineales se refiere a la forma en que se codifican los comandos para que los dispositivos los entiendan. Los comandos multilineales siguen una codificación especial basada en caracteres ASCII de 7 bits que ayuda a identificar su tipo y naturaleza. Estos comandos pueden ser utilizados para controlar dispositivos en secuencias complejas y detalladas, permitiendo una comunicación más sofisticada.

En resumen, los comandos universales se utilizan para enviar instrucciones a todos los dispositivos en el bus, los comandos indirizados se utilizan para comunicarse con dispositivos específicos, el modo comando es donde se envían comandos y el modo data es donde se transmiten datos. La estructura de comandos multilineales proporciona una forma de codificar comandos más complejos que requieren una secuencia de pasos. La combinación de estos conceptos permite una comunicación versátil y precisa en sistemas IEEE 488.1.


#### Observaciones
Es importante destacar la diferencia en el protocolo de enlace entre el modo comando y el modo datos. En modo comando, todas las interfaces participan en la temporización, lo que establece la velocidad de comunicación según el periférico más lento. En modo datos, solo las interfaces de los oyentes activados participan en la temporización, lo que permite velocidades de transmisión más altas.
#### Resumen español
Aquí un resumen de los conceptos clave del apunte sobre los modos de datos y comandos en IEEE 488.1:

- Existen dos modos de funcionamiento: modo comando y modo datos.

- El modo comando se usa para enviar instrucciones y comandos. La línea ATN está activa (true).

- El modo datos se usa para transmitir datos entre dispositivos. La línea ATN está inactiva (false).

- En modo comando, el controlador es el "source-handshake" y se comunica con todos los dispositivos.

- En modo datos, el "talker" es el "source-handshake" y se comunica con los "listener".

- El controlador alterna entre los dos modos cambiando el estado de ATN.

- Los comandos universales se envían a todos los dispositivos. Los comandos direccionados solo a dispositivos específicos.

- Los comandos multilínea siguen una estructura y secuencia especial de caracteres ASCII.

- En modo comando, la comunicación se adapta al dispositivo más lento. En modo datos puede ser más rápida.

En resumen, el protocolo alterna entre modo comando y datos para enviar instrucciones o información. El controlador maneja la línea ATN para cambiar entre modos.


### Comandos Universales

Estos comandos son transmitidos por el controlador y recibidos por todas las interfaces conectadas al bus. Hay 8 comandos universales, de los cuales 3 son comandos unilineales y 5 son comandos multilineales.

#### Comandos Universales Unilineales
- *ATN:* Atención
- *REN:* Habilitación Remota
- *IFC:* Limpieza de Interfaz

Para su transmisión, no se requiere realizar una fase de handshake.

##### REN: Habilitación Remota
Cuando se establece el direccionamiento de los dispositivos, estos deshabilitan el panel de control que poseen. Cuando está activo, los dispositivos se preparan para recibir comandos que regulan su funcionamiento a través de las interfaces conectadas al bus. Cuando se desactiva, los dispositivos abandonan el modo remoto y vuelven al modo de funcionamiento local, permitiendo la programación manual.

##### IFC: Limpieza de Interfaz
Este comando provoca la interrupción de cualquier acción de las interfaces, devolviéndolas a una condición predeterminada según la definición del estándar IEEE 488. Las interfaces del "talker" y los "listener" previamente direccionados abandonan el estado de actividad y entran en modo de espera, y el sistema asume el modo de funcionamiento "command mode".

#### Comandos Universales Multilineales
Son 5 comandos transmitidos por el controlador durante el modo de funcionamiento "command mode", es decir, con la línea ATN en estado lógico "verdadero". Se lleva a cabo a través de las líneas DI01-7 del bus de datos, involucrando a todas las periféricas conectadas al bus en el procedimiento de handshake.

##### Estructura de los Comandos Multilineales

- Los comandos universales multilineales y los direccionados se codifican con caracteres ASCII en los que los bits 7 y 6 están en estado lógico "00".
- Los comandos de deselección y las direcciones principales se codifican utilizando caracteres en los que estos bits están en la configuración "10" (actividad en los "talkers") o "01" (actividad en los "listeners").
- Las direcciones secundarias se codifican utilizando caracteres en los que los bits 7 y 6 están en estado lógico "11".

##### DCL: Limpieza del Dispositivo
- Codificado ASCII: DC4
Todas las periféricas conectadas asumen un estado predeterminado. Este estado no está establecido por el estándar IEEE 488.1 y, por lo tanto, puede variar de una periférica a otra.

##### LLO: Bloqueo Local
- Codificado ASCII: DC1
Deshabilita la función de un botón de comando generalmente presente en las periféricas, permitiendo así la programación desde su propio panel de control.

##### SPE, SPD: Activar Serial Poll y Desactivar Serial Poll
- Codificado ASCII: CAN y EM
El primero activa una función de diagnóstico especial ejecutable por algunas interfaces de periféricas, y el segundo la desactiva.

##### PPU: Desconfiguración de Encuesta Paralela
- Codificado ASCII: NAK
Finaliza otra función de diagnóstico denominada "encuesta paralela".

##### REN vs LLO
- REN:
    - Habilita el modo remoto para un dispositivo específico en el bus.
    - Permite que ese dispositivo reciba comandos del controlador (computadora).
    - El dispositivo puede volver a modo local si recibe LLO o otro comando.
- LLO:
    - Bloquea todos los dispositivos en el modo remoto.
    - Ningún dispositivo puede volver a modo local mientras esté activo LLO.
    - Sólo el controlador puede deshabilitar LLO cuando lo requiera.

En resumen:

- REN es por dispositivo, LLO es global.
- Con REN el dispositivo puede volver a modo local, con LLO no.
- REN da más flexibilidad, LLO más control total al controlador.
### Solicitud de Servicio
Algunas interfaces periféricas tienen la capacidad de realizar una 'solicitud de servicio' al controlador. Esto se logra cambiando el estado de la línea SRQ (Service Request) a 'verdadero'. El controlador detecta esta solicitud muestreando la condición de la línea SRQ.

La solicitud de servicio es importante para los dispositivos periféricos porque les permite interrumpir la actividad del controlador de forma asíncrona, incluso cuando la interfaz no está habilitada para comunicarse a través del bus de datos. Las causas de estas solicitudes pueden variar, desde condiciones anómalas que podrían afectar el funcionamiento del sistema hasta situaciones específicas en el sistema.

#### Procedimientos de Interrogación
Para que el controlador pueda determinar directamente qué dispositivo periférico ha generado la solicitud de servicio, realiza un proceso comúnmente llamado 'encuesta'.
Existen la 'encuesta serial' y la 'encuesta paralela'.
**Encuesta Paralela:** En esta, el controlador interroga a todos los dispositivos periféricos simultáneamente y puede identificar cuál de ellos ha activado la línea SRQ. Es más rápido, pero no es igual de preciso en la identificación del dispositivo periférico específico que generó la solicitud de servicio.
**Encuesta Serial:** En esta, el controlador interroga cada dispositivo periférico uno por uno para identificar cuál de ellos ha generado la solicitud de servicio. Este proceso es más lento, pero es útil para un diagnóstico preciso.

##### Encuesta Serial
El procedimiento de encuesta serial se realiza mediante el controlador, que activa el modo de comando en el sistema. En este proceso, el controlador direcciona sucesivamente las diferentes interfaces conectadas al bus y recibe de cada una de ellas una respuesta en forma de un "byte de estado", que resume las condiciones de funcionamiento de ese dispositivo periférico.

La encuesta serial se activa mediante la transmisión del comando universal multilinea "serial poll enable" (SPE). Desde el momento en que se envía el comando SPE hasta la transmisión del comando complementario "serial poll disable" (SPD), cada dispositivo periférico puede funcionar como emisor en los niveles T1, T2, T5 y T6 (o los niveles correspondientes TE1, TE2, TE5 y TE6 en el caso de dispositivos periféricos con dirección secundaria). Responde a la transmisión de su dirección de conversación TAD con un carácter que describe su estado operativo.

El estándar IEEE 488 especifica que el dispositivo periférico que ha activado la línea SRQ debe transmitir el carácter con el séptimo bit en estado lógico "verdadero", conocido como RQS, que se transmite en la línea DIO7. Los otros bits del carácter de estado se utilizan para describir la causa de la solicitud de servicio, codificada de manera variable según el tipo de dispositivo periférico. El controlador debe decodificar la información en las respuestas de los dispositivos periféricos para identificar tanto al dispositivo como la causa de la solicitud de servicio.
![[Pasted image 20231103162412.png]]

##### Encuesta Paralela
Por otro lado, el procedimiento de "encuesta paralela" no permite un diagnóstico detallado sobre el estado de funcionamiento de los dispositivos periféricos. Solo permite examinar hasta 8 dispositivos periféricos simultáneamente, pero es considerablemente más rápido. Cada interfaz responde al controlador informando su "bit de estado" (RQS) en una línea de datos del bus. El controlador debe configurar previamente los dispositivos periféricos para realizar el procedimiento de interrogación antes de activar la encuesta paralela. Cada interfaz está configurada para responder en una línea específica del bus de datos. Esto permite al controlador identificar la interfaz que ha activado la solicitud de servicio. La transmisión del comando "parallel polling unconfigure" (PPU) provoca la pérdida de la configuración y los dispositivos periféricos deben configurarse nuevamente si se necesita una nueva sesión de encuesta paralela.
![[Pasted image 20231103162425.png]]


### Comandos Direccionados

Hay 5 comandos direccionados que forman un conjunto especial de comandos multilineales. Su transmisión requiere dos fases sucesivas: primero, el controlador debe direccionar las periféricas a las que se destina el comando mediante el "listen address" (LAD), y luego, aún en modo de funcionamiento "command mode", transmitir el carácter ASCII correspondiente al comando deseado.

#### GET: Group Execute Trigger
- ASCII: BS
Obliga a las periféricas previamente direccionadas a comenzar la ejecución de la función actualmente seleccionada.

#### GTL: Go To Local
- ASCII: SOH
Provoca la transición solo de las periféricas direccionadas del estado remoto al estado local, volviendo a habilitar el panel de control de los instrumentos seleccionados.

#### SDC: Selected Device Clear
- ASCII: EOT
Con este comando, el controlador hace que las periféricas seleccionadas asuman una configuración predeterminada. La acción y el estado asumido por las periféricas son iguales a los resultantes de la transmisión del comando multilineal DCL, pero afectan solo a los "listeners" seleccionados.

#### TCT: Take Control
- ASCII: HT
El controlador en carga cede su propio rol a otro controlador.

#### PPC: Parallel Poll Configure
- ASCII: ENQ
Se utiliza para preparar una periférica para la ejecución de una función de diagnóstico llamada "parallel poll".


## Estructura de los Mensajes

Los mensajes que se transmiten a través del bus pueden consistir en comandos para las interfaces o en comandos y datos intercambiados entre las periféricas.

- Los mensajes de las interfaces deben seguir las convenciones indicadas en el estándar y ya explicadas; por otro lado, los mensajes dependientes del dispositivo no están codificados y se deja a los diseñadores de las periféricas la libertad de definir las estructuras y formas de estos mensajes.

- Los mensajes de los dispositivos son aquellos transmitidos entre dispositivos (por ejemplo, valores de variables a medir).

- Los mensajes de las interfaces están dictados por normas y se utilizan para el correcto funcionamiento del proceso (quién actúa como controlador, talker o listener, cuánto está permitido hablar, etc.).

### Instrucciones de Programación
Las instrucciones de programación transmiten los comandos utilizados para activar el control de las funciones de los dispositivos periféricos. Estos mensajes están compuestos por grupos de caracteres que, cuando son recibidos por los dispositivos periféricos, configuran sus parámetros operativos, determinando, por ejemplo, el tipo de función a ejecutar, el alcance, el valor de una cantidad a generar. Se ha extendido el uso de codificar estos comandos mediante códigos alfanuméricos formados por una o dos letras seguidas de un número: el prefijo alfabético identifica la función sobre la que se actúa, y el número codifica el valor a configurar. Para facilitar el uso del sistema, se busca utilizar una codificación que permita una fácil interpretación del comando y, por lo tanto, las diferencias entre herramientas equivalentes, incluso de diferentes fabricantes, son modestas.

### Datos a Visualizar
Los datos a mostrar son caracteres que corresponden a textos o datos que el dispositivo periférico receptor debe mostrar a través de un dispositivo de salida (monitor, pantalla, impresora) o almacenar. Estos mensajes se transmiten exclusivamente utilizando el conjunto de caracteres ASCII imprimibles, es decir, los caracteres comprendidos entre 32 y 127 en la tabla ASCII. Entre ellos se encuentran todas las letras del alfabeto (mayúsculas y minúsculas), números arábigos, signos de puntuación, signos de operaciones aritméticas y otros símbolos gráficos. De esta manera, los mensajes se transmiten, carácter por carácter, en una secuencia ordenada. La finalización de la comunicación puede ser indicada tanto mediante la conmutación de la línea EOI como mediante la transmisión de un terminador compuesto por caracteres ASCII no incluidos en el conjunto de caracteres imprimibles, por ejemplo, | RC | y | LF |.

### Resultados de Medición
El grupo de resultados de las mediciones incluye todos aquellos mensajes con los cuales los instrumentos analíticos comunican los números que representan los resultados de las mediciones realizadas. Existen dos estructuras típicas de estas comunicaciones, que difieren según si los valores se transfieren en forma binaria o decimal.

En el primer caso, se reconocen los mensajes transmitidos por aquellos dispositivos que codifican el resultado de la medición, obtenido mediante procesos de discretización, como un número binario de 8 o 16 bits. Utilizando un código de 8 bits, es posible reconocer 256 niveles discretos, que aumentan a 65.536 con el uso de la representación de 16 bits.

Por lo tanto, la codificación tiene la ventaja de permitir una representación muy "densa" de los valores numéricos transferidos y, gracias a su capacidad para comprimir una gran cantidad de información en pocos caracteres, es especialmente adecuada para la transferencia de información que incluye una cantidad significativa de valores numéricos discretos.

Por otro lado, estos instrumentos suelen utilizar la codificación decimal, incluidos multímetros, frecuencímetros y contadores, que transmiten el resultado de sus mediciones a través de una secuencia de caracteres ASCII que forman un número decimal.
